## Jun 18, 2013 - John - accept either blank or null in Industry columns
## Jun 21, 2013 - John - convert "H" to "HQ" in Business Units
## August 23, 2013 - John M. Shoemaker, calc "K" by 1000 rather than 1024
## October 11, 2013 - John M. Shoemaker, multiple changes 
## February 12, 2014 - John M. Shoemaker, add timestamp
## March 24, 2014 - John M. Shoemaker, add HQ
## September 04, 2014 - John M. Shoemaker, add secret version option
## September 15, 2014 - John M. Shoemaker - add additional contacts
## October 07, 2014 - John M. Shoemaker - include contacts with region/eu as directed
## October 17, 2014 - John M. Shoemaker - include skills inline
## October 24, 2014 - John M. Shoemaker - align rag table to top
## November 11, 2014 - John M. Shoemaker - activate CtlRec.cflg3
## November 24, 2014 John M. Shoemaker, expand to 30 skills
## December 16, 2014 John M. Shoemaker, add certs to secret version
## December 23, 2014 John M. Shoemaker, use periods for blanks in skills
## February 02, 2015 John M. Shoemaker, convert to UNITS
## March    03, 2015 John M. Shoemaker, add additional fields for units (ctp1/2/3,lead,tier)
## March    18, 2015 John M. Shoemaker, revert to revenue (previous year and last 12 months)
## April    03, 2015 John M. Shoemaker, add tier if available
## May      01, 2015 John M. Shoemaker, fix text color of contacts in regions
## May      21, 2015 John M. Shoemaker, allow update of skills as appropriate
## June     10, 2015 John M. Shoemaker, fix error in p_phone update line
## June     22, 2015 John M. Shoemaker, add in PCR to the cross table & expand edits to all successes
## July     08, 2015 John M. Shoemaker, allow edit of all contacts
## September08, 2015 John M. Shoemaker, add coverage note #89
## January  27, 2016 John M. Shoemaker, add description of diff SU CTPs
## February  17, 2016 John M. Shoemaker, filter out reseller X
## February  23, 2016 John M. Shoemaker, allow option of only showing ACAs
## February  25, 2016 John M. Shoemaker, expand extra contacts to include Reg/EBU in contact section
## March     08, 2016 John M. Shoemaker, allow edit of other contacts #142
## March     23, 2016 John M. Shoemaker, capture email of person doing update #158
## April     05, 2016 John M. Shoemaker, allow for options for Storage #160
## April     06, 2016 John M. Shoemaker, add global msg #145
## April     13, 2016 John M. Shoemaker, show extended contacts for storage #160
## May       04, 2016 John M. Shoemaker, allow update of extended contacts #164
## May       26, 2016 John M. Shoemaker, correct bug  #166
## May       31, 2016 John M. Shoemaker, show swita/sca as appropriate
## June      07, 2016 John M. Shoemaker, show GSI #112
## June      13, 2016 John M. Shoemaker, correct logic for showing form 513
## July      19, 2016 John M. Shoemaker, correct logic for showing form 506 with partners_well
## July      22, 2016 John M. Shoemaker, add support for markets/industries, #174
## August    08, 2016 John M. Shoemaker, add ind_education
## August    09, 2016 John M. Shoemaker, add expanded support of Industry, #178
## August    11, 2016 John M. Shoemaker, add logic for ACA term for non-AU
## August    16, 2016 John M. Shoemaker, continue support of Industry, #178
## September 09, 2016 John M. Shoemaker, make segmentation an option, #184
## December  09, 2016 John M. Shoemaker, migrate to competency, #192
## January   03, 2017 John M. Shoemaker, remove BPTV, #192
## January   26, 2017 John M. Shoemaker, change Current Year revenue to Rolling 12 Months, #195
## January   27, 2017 John M. Shoemaker, move pw program level url to master table, #196
## January   27, 2017 John M. Shoemaker, add POD info, #197
## April     11, 2017 John M. Shoemaker, add LAP column, #212
## April     13, 2017 John M. Shoemaker, migrate from SVP to CVR, #213
## April     14, 2017 John M. Shoemaker, add Activity Tracking section, #214
## April     14, 2017 John M. Shoemaker, add DFM flag, #215
## April     19, 2017 John M. Shoemaker, add authorization to update/add, #217
## April     24, 2017 John M. Shoemaker, add page counts, #219
## May       08, 2017 John M. Shoemaker, add showcerts option, #220
## May       10, 2017 John M. Shoemaker, add showenterprisealign and showindustryalign, #223 #224
## May       17, 2017 John M. Shoemaker, allow update mode via main detail page, #225
## May       22, 2017 John M. Shoemaker jshoemaker1@cox.net, sync up columns for competency, #231
## May       22, 2017 John M. Shoemaker jshoemaker1@cox.net, ensure secret version hidden, #226
## June      12, 2017 John M. Shoemaker jshoemaker1@cox.net, add social review, #235
## June      27, 2017 John M. Shoemaker jshoemaker1@cox.net, add gsd solutions, #183
## August    09, 2017 John M. Shoemaker jshoemaker1@cox.net, add activity section, #214
## August    10, 2017 John M. Shoemaker jshoemaker1@cox.net, add target/pv section, #248
## August    25, 2017 John M. Shoemaker jshoemaker1@cox.net, use target/pv columns by qtr, #250
## August    25, 2017 John M. Shoemaker jshoemaker1@cox.net, secret & noheader pages dynamic, #246, #251
## September 18, 2017 John M. Shoemaker jshoemaker1@cox.net, add gsd solutions inline, #183
## September 20, 2017 John M. Shoemaker jshoemaker1@cox.net, chg Submit button names in update mode, #260
## September 28, 2017 John M. Shoemaker jshoemaker1@cox.net, change to revised format #263
## October   10, 2017 John M. Shoemaker jshoemaker1@cox.net, replace Normalized revenue, #270
## October   18, 2017 John M. Shoemaker jshoemaker1@cox.net, remove solutions from competency tab, #274
## October   19, 2017 John M. Shoemaker jshoemaker1@cox.net, correct company url, #275
## November  06, 2017 John M. Shoemaker jshoemaker1@cox.net, correct PW Profile url, #284
## December  06, 2017 John M. Shoemaker jshoemaker1@cox.net, add update email/pin (to old update)
## December  12, 2017 John M. Shoemaker jshoemaker1@cox.net, add certs, #290
## January   15, 2018 John M. Shoemaker jshoemaker1@cox.net, use control for activity table names, #295
## January   23, 2018 John M. Shoemaker jshoemaker1@cox.net, allow image in description, #299
## January   31, 2018 John M. Shoemaker jshoemaker1@cox.net, migrate to sales specialties, #300
## February  01, 2018 John M. Shoemaker jshoemaker1@cox.net, changes for Systems, #301,#303,#304,#305
## February  02, 2018 John M. Shoemaker jshoemaker1@cox.net, changes for Systems, #306, #307, #308
## February  14, 2018 John M. Shoemaker jshoemaker1@cox.net, scroll bar in planning section, #316
## February  15, 2018 John M. Shoemaker jshoemaker1@cox.net, correct error in market updates, #317
## February  16, 2018 John M. Shoemaker jshoemaker1@cox.net, allow building list from reps, #320
## March     26, 2018 John M. Shoemaker jshoemaker1@cox.net, allow edit of alt name, #318
## April     02, 2018 John M. Shoemaker jshoemaker1@cox.net, dynamic build of partrt page, #319
## May       08, 2018 John M. Shoemaker sixshoeter@gmail.com, correct GSD base link, #323
## May       14, 2018 John M. Shoemaker sixshoeter@gmail.com, add MasterRec columns for dirs, #324
## May       25, 2018 John M. Shoemaker sixshoeter@gmail.com, move to new Cert data source, #325

globals "globals.4gl"

define
   SuccessArr array[40] of 
      record
         s_title like success_nc.s_title,
         s_link like success_nc.s_link
      end record,
   EUDetails array[30] of char(1),
   INDDetails array[30] of char(1),
   CTPArr array[10] of char(20),  
   ctpidx smallint,
   tUnitBrandRec record like unit_brand.*,
   UnitBrandArr array[15] of record like unit_brand.*,
   ActInitRec record like act_initiative.*,
   ActRec record like activity.*,
   stat_desc char(11),
   type_desc char(30),
   tmp_pname like coverage_nc.part_name

 

main

define
    SSRRec record like reps.*,
    CTP1Rec record like reps.*,
    CTP2Rec record like reps.*,
    CTP3Rec record like reps.*,
    CTP4Rec record like reps.*,
    CTP5Rec record like reps.*,
    VRec record like vads.*,
    GSDRec record like gsd_solutions.*,
    GSDArr array[500] of 
       record
          sol_id like gsd_solutions.sol_id,
          sol_name like gsd_solutions.sol_name,
          sol_url like gsd_solutions.sol_url,
          comp_name char(512)
       end record,
    lastDtRec record
       mo smallint,
       dy smallint,
       yr smallint,
       hrmi char(5)
    end record,
    i,j,newi,c,gcnt smallint,
    oRegion like eus.e_region,
    oMarket like industry.ig_name,
    oBU like competency.bu,
    successCnt smallint,
    qtrStr, gsdStr char(512),
    colorStr char(16),
    textcolorStr char(16),
    BPTV_cnt smallint,
    skillStr char(96),
    tamt float,
    buStr char(2),
    tURL like coverage_nc.pwp,
    showHeader smallint,
    secretVer smallint,
    currYear smallint,
    prevYear smallint,
    vapcnt smallint,
    goVAP smallint,
    lstr like reps.r_link,
    stateStr like states.s_name,
    showTableHeader smallint,
    lastRag, cText like certs.prod_group,
    Scnt, Tcnt smallint,
    tBrandRec record like brands.*,
    SQLStr char(512),
    SQLStr1 char(512),
    SQLStr2 char(1024),
    tidx, SkilledYN smallint,
    tdesc like unit_brand.desc,
    tmpStr char(32),
    tseg_name like segmentation.seg_name,
    ctp_cnt smallint,
    retS1, retS2 char(20),
    color_idx smallint,
    tRcnt, inCompStat, idx smallint,
    snum1, enum1 float,
    pw_lev like competency.pw_level,
    pcrName like pod_info.pcr,
    pcrcnt smallint,
    button_face char(10),
    rcnt smallint,
    ravg smallfloat,
    rStr char(512),
    nStr char(100),
    TrgRec record like target.*,
    tQtr char(1),
    starcnt, starmax, tTgt, tPV integer,
    tmpRev like competency.rev_curr_resale_yr,
    dispLevel char(20),
    flg1,flg2,flg3,flg4,flg5 smallint

#set explain on;
call ReadCmdLn( "nbuildPagesS", 5 )
call ProcCmdLn( "nbuildPagesS" )
let secretVer = FALSE
let UpdateAllow = FALSE
let showHeader = arg_val(5)

if( showHeader > 0 )then
#   if( showHeader > 1 and NOT RevBox )then   #(only generate for brands not showing revenue)
   if( showHeader > 1 )then   
      let secretVer = TRUE
      if( showHeader = 5 )then
         let UpdateAllow = TRUE
      end if
   end if
   let showHeader = TRUE
else
   let showHeader = FALSE
end if

## for REVISED pages, will not show the header, so overriding this setting
let showHeader = FALSE

call LoadBPTVRec( CLRec.ceid )
call GetColor(BRec.b_id, 0,1) returning colorStr, textcolorStr
call GetRevDates() returning prevYear, currYear

# cross-brand
if( CtlRec.showcrossflg )then
   call LoadCrossRec( CLRec.ceid )
end if

   let qtrStr = "select a.*,r.*, s.*, t.*, u.*, w.*, x.*, v.* ",
   "from ", cov_tab clipped, " a, outer reps r, outer reps s, outer reps t, outer reps u, outer reps w, outer reps x, outer vads v ",
   "where a.ceid = '", CLRec.CEID clipped, "' ",
     "and a.ssr = r.r_name ",
     "and a.ctp1 = s.r_name ",
     "and a.ctp2 = t.r_name ",
     "and a.ctp3 = u.r_name ",
     "and a.ctp4 = w.r_name ",
     "and a.ctp5 = x.r_name ",
     "and a.vad = v.v_id "


#display qtrStr
#whenever error continue
prepare QID from qtrStr
#display sqlca.sqlcode
declare ACurs cursor for QID




foreach ACurs into URec.*, SSRRec.*, CTP1Rec.*, CTP2Rec.*, CTP3Rec.*, CTP4Rec.*, CTP5Rec.*, VRec.*

   call ShowTitleDetailS( showHeader, URec.ceid, UpdateAllow )
   display " "

## display Partner Name
if( UpdateAllow )then
   display "<div style='width: 80%; margin: 0 auto;'>"
#   display "<h1 class='centerText' style='text-align: center;'><strong><a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/S/", URec.ceid clipped, ".html'>", URec.part_name clipped, "</a></strong></h1>"
   display "<h1 class='centerText' style='text-align: center;'><strong><a href='/", MasterRec.cgi_dir clipped, "/showNew", BRec.b_id clipped, "S.ksh?", URec.ceid clipped, "' target='pdetails'>", URec.part_name clipped, "</a></strong></h1>"
else
   display "<div style='width: 80%; margin: 0 auto;'>"
   display "<h1 class='centerText' style='text-align: center;'><strong>", URec.part_name clipped, "</strong></h1>"
display "</div>"
#display "<img  style='block; width: auto; height: auto'; src='/", IRec.i_id clipped, "/I/", URec.ceid clipped,".jpg' id='theImgID' /></td>"
end if  #UpdateAllow
##-----------------------------------------------------------------------------------------------------
## Build Partner Detail Menu - START
##-----------------------------------------------------------------------------------------------------
display "<div class='w3-bar my-blue'>"
display '  <button class="w3-bar-item w3-button tablink my-gray" onclick="openTab(event,', "'Bio')",'">Profile</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Competency')",'">Competency</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Skills')",'">Skills</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Solutions')",'">Solutions</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'References')",'">References</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Markets')",'">Markets</button>'
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Geographies')",'">Geographies</button>'
if( CtlRec.showcerts )then
   display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Certifications')",'">Certifications</button>'
end if
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Contacts')",'">Contacts</button>'
if( CtlRec.showplanning or (BRec.b_id='NC' and URec.ceid='18z7gkgl')) then
   display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Planning')",'">Planning</button>'
end if  #show activity planning
display '  <button class="w3-bar-item w3-button tablink" onclick="openTab(event,',"'Other')",'">Other</button>'
display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build Partner Detail Menu - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build BIO - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Bio' class='tab' style='padding: 10px; display: block;'>"
if( UpdateAllow )then
   display "<FORM ID='desc'  ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Description Change'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=501>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
   display "<TEXTAREA NAME='desc' rows='25' cols='100'>", URec.desc clipped, "</TEXTAREA>"
   display "</FORM>"
else
   display "<p>"

## make url consistent with http prefix
   if( URec.url is not null and URec.url != " " )then
      if( URec.url[1,4] = "http" )then
         let tURL = URec.url clipped
      else
         let tURL = "http://", URec.url clipped
      end if
   end if  #url

   if( URec.url is not null and URec.url != " " )then
      display "<a href='", tURL clipped, "' target='_blank'><img align='left' height='64' src='/", IRec.i_id clipped, "/I/", URec.ceid clipped, ".jpg' width='140' style='padding: 10px;' alt='' title='", URec.url clipped, "'></a>", URec.desc clipped
   else
   display "<img align='left' alt='' height='64' src='/", IRec.i_id clipped, "/I/", URec.ceid clipped, ".jpg' width='140' alt='' style='padding: 10px;'>", URec.desc clipped
   end if

## show description image if present
   if( CtlRec.showdescimg )then
      display "<img id='descimg' src='/", IRec.i_id clipped, "/I/", URec.ceid clipped, "-desc.jpg' onerror='/", IRec.i_id clipped, "/I/", URec.ceid clipped, ".jpg' alt=''>"
   end if  #showdescimg

end if

display "<p></p>"

## display the PW Profile if present
## make url consistent with http prefix
   if( URec.pwp is not null and URec.pwp != " " )then
      if( URec.pwp[1,4] = "http" )then
         let tURL = URec.pwp clipped
      else
         let tURL = "http://", URec.pwp clipped
      end if
   end if  #url
if( URec.pwp is not null and URec.pwp != " " ) then
   display "<a href='", tURL clipped, "' target='_blank'>PartnerWorld Profile", "</a><br>"
end if  #pwp

## display the CEID
#display "CEID: <a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/P/", URec.ceid clipped, ".html' target='_blank'>", URec.ceid clipped, "</a>"
## build on demand rather than use static page
display "CEID: <a href='/", MasterRec.cgi_dir clipped, "/showOld", BRec.b_id clipped, "S.ksh?", URec.ceid clipped, "' target='_blank'>", URec.ceid clipped, "</a>"

## display the VAD
if( VRec.v_id != "na" and VRec.v_id != " " )then
   display "<p>Software Distributor: <a href='", VRec.v_link clipped, "' target='_blank'>", VRec.v_name clipped, " </a></p>"
end if

## display the Social
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Social Feedback</strong>"
display "&nbsp;"
display "<img onclick='socialPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Social Explanation'></p>"
display "<div class='popup' onclick='socialPopUp()'>"
display "<div class='popuptext' id='SOCPUP'><h2>Social Feedback Explanation</h2>"
display MasterRec.social_txt 
display "</div>"
display "</div>"

call commentInfo( URec.ceid ) returning rcnt, ravg
let rStr=getRatingStars( ravg )
display "<td class='tdborder'><a href='/", MasterRec.cgi_dir clipped, "/review", BRec.b_id clipped, "S.ksh?",
        URec.ceid clipped, "' target='_blank'>", rStr clipped, "</a></td>"

display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build BIO - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build COMPETENCY - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Competency' class='tab' style='display:none; padding: 10px'>"


################################################################
## COMPETENCY SECTION START
################################################################
################################################################
## TARGET SECTION START
################################################################

################################################################
## Target/PV Section
################################################################
if( CtlRec.showtarget )then
   display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Storage Target and PV Information</strong>"
   display "&nbsp;"
   display "<img onclick='targetPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Target Explanation'></p>"
   display "<div class='popup' onclick='targetPopUp()'>"
   display "<div class='popuptext' id='TARGETPUP'><h2>Target & PV Explanation</h2>"
   display MasterRec.target_txt 
   display "</div>"
   display "</div>"
   call LoadTargets( URec.ceid ) returning TrgRec.*
#   if( TrgRec.t_st_q3_target >0 or TrgRec.t_st_q3_pv > 0)then
      let tQtr=currQtr()
#display "tQtr: ", tQtr
      case tQtr
         when "1"
            let tTgt=TrgRec.t_strg_q1_target
            let tPV=TrgRec.t_strg_q1_pv
         when "2"
            let tTgt=TrgRec.t_strg_q2_target
            let tPV=TrgRec.t_strg_q2_pv
         when "3"
            let tTgt=TrgRec.t_strg_q3_target
            let tPV=TrgRec.t_strg_q3_pv
         when "4"
            let tTgt=TrgRec.t_strg_q4_target
            let tPV=TrgRec.t_strg_q4_pv
         otherwise
            let tTgt=0
            let tPV=0
      end case  #tQtr

      display "<table border='0' width='744px'>"
      display "<tbody><tr>"
      display "<td class='bottomborder'>"
      display "<strong>Target</strong></td>"
      display "<td class='bottomborder'>", tTgt using "$$$,$$$,$$$","</td>"
      display "</tr><tr>"
      display "<td class='bottomborder'>"
      display "<strong>PV</strong>"
      display "<td class='bottomborder'>", tPV using "$$$,$$$,$$$","</td>"
      display "</tr></tbody></table>"

      display "</table>"

end if  #showtarget
################################################################

################################################################
## TARGET SECTION END
################################################################
if( CtlRec.showcompetency )then
#if( CtlRec.showcompetency and (URec.ceid='7epgd' or URec.ceid='18z7govd' or URec.ceid='6c33d' or URec.ceid='18z7gey8' or URec.ceid='18z7ge5l' or URec.ceid='18z7gkgl' or URec.ceid='18z7gkgl'))then

## retrieve comp data for this partner
call LoadCompArr( BRec.b_id, URec.ceid )
let G_SVPinfocnt = LoadSVPInfoArr( BRec.b_id, URec.ceid )

#if( URec.ceid='XXXXXXXX' )then
#if( URec.ceid='18z7giva' )then
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Competency Status</strong>"
display "&nbsp;"
display "<img onclick='myFunction()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Competency Explanation'></p>"
display "<div class='popup' onclick='myFunction()'>"
display "<div class='popuptext' id='myPopup'><h2>Competency Explanation</h2>"
display MasterRec.comp_txt
display "</div>"
display "</div>"

if( G_COMPcnt > 0 )then
   display "<table border='0' width='800px'>"
   display "<tbody>"
   display "<tr><td>"
   


   let obu=" "
   for i = 1 to G_COMPcnt
      if( CompArr[i].bu != obu )then
         if( CompArr[i].bu != obu and i>1 )then
            display "</tbody></table></tbody></table>"
         end if
         display "<table cellspacing='0' border='0' style='padding-left: 10px;' class='mytable'>"
         display "<tbody>"
         display "<tr><td colspan='1' style='width: 200px; vertical-align: top;' class='bottomborder'>"
         display "<strong>", CompArr[i].bu clipped, "</strong></td>"
         display "<td class='bottomborder'>"
         display "<table cellspacing='0' cellpadding='2' class='mytable'>"
         display "<tbody><tr>"
#         display "<td class='bottomborder2' width='250' style='height: 25px'><strong>Competency</strong></td>"
         display "<td class='bottomborder2' width='300' style='height: 25px'><strong>Competency</strong></td>"
#         display "<td class='bottomborder2' width='90' style='height: 25px'><strong>Status</strong></td>"
         display "<td class='bottomborder2' width='100' style='height: 25px'><strong>Status</strong></td>"
#REMOVE#274         display "<td class='bottomborder2' width='80' style='height: 25px'><strong>Solutions</strong></td>"
         if( CtlRec.revbox and CtlRec.revflg )then
#            display "<td class='bottomborder2' width='90' style='height: 25px' align='center';><strong>Resale</strong></td>"
            display "<td class='bottomborder2' width='100' style='height: 25px' align='center';><strong>Resale</strong></td>"
#	    display "<td class='bottomborder2' width='90' style='height: 25px' align='center';><strong>Influence</strong></td>"
	    display "<td class='bottomborder2' width='100' style='height: 25px' align='center';><strong>Influence</strong></td>"
         end if  #OK to show revenue
         let obu=CompArr[i].bu
      end if  #new bu

      let dispLevel=" "
      display "<tr><td class='bottomborder2'>", CompArr[i].comp_name clipped, "</td>"
      display "<td class='bottomborder2'>"
      if( CompArr[i].achieved_level is NULL or CompArr[i].achieved_level=" " )then
         let dispLevel="In Progress"
      else
         let dispLevel=CompArr[i].achieved_level 
      end if
      display "<a href='/", MasterRec.cgi_dir clipped, "/ShowCompStatS", BRec.b_id clipped, ".ksh?", URec.ceid clipped, ":", CompArr[i].comp_name clipped, "' target='_blank'>",  dispLevel clipped, "</a></td>"
#      display dispLevel clipped, "</td>"
#REMOVE#274      display "<td class='bottomborder2' align='center'>", CompArr[i].sols clipped, "</td>"

#########################
## Show Revenue
#########################
      let tmpRev=0
      if( CtlRec.revbox and CtlRec.revflg )then
##    show resale
         if(  (CompArr[i].rev_curr_resale_yr > 0 and CompArr[i].rev_curr_resale_yr is not null) or
              (CompArr[i].rev_curr_xaas_yr > 0 and CompArr[i].rev_curr_xaas_yr is not null) )then

##       handle if nulls - create temp holding var to display
         if( CompArr[i].rev_curr_resale_yr is not NULL )then 
               let tmpRev=tmpRev+CompArr[i].rev_curr_resale_yr
            end if
            if( CompArr[i].rev_curr_xaas_yr is not NULL )then 
               let tmpRev=tmpRev+CompArr[i].rev_curr_xaas_yr
            end if
   
            display "<td class='bottomborder2' align='right'>", tmpRev using "$$,$$$,$$$,$$$", "</td>"
         else
            display "<td class='bottomborder2'></td>"
         end if  #resale $

##    show influence
         if(  CompArr[i].rev_curr_influence_yr > 0 and CompArr[i].rev_curr_influence_yr is not null )then
            display "<td class='bottomborder2' align='right'>", CompArr[i].rev_curr_influence_yr using "$$,$$$,$$$,$$$", "</td>"
         else
            display "<td class='bottomborder2'></td>"
         end if  #influence $
      end if  #revbox and revflg

      display "</tr>"
   end for  #G_COMPcnt

   display "</tbody>"
   display "</table>"
   display "</td></tr></tbody></table>"
   display "</td></tr>"
   display "</table>"
   end if  #G_COMPcnt > 0

## show resell authorizations
   display "<p>&nbsp;</p>"
   display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Resell Authorization Approvals</strong>"
   display "&nbsp;"
   display "<img onclick='resellPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Resell Explanation'></p>"
   display "<div class='popup' onclick='resellPopUp()'>"
   display "<div class='popuptext' id='RESELLPUP'><h2>Resell Authorization Explanation</h2>"
   display MasterRec.social_txt 
   display "</div>"
   display "</div>"
  
   if( G_SVPinfocnt > 0 )then
      display "<table border='0' width='744px' cellpadding='5'>"
      display "<tbody><tr>"

      for i = 1 to G_SVPinfocnt
#         if( SVPInfoArr[i].prod_stdt is not null )then
         if( SVPInfoArr[i].prod_grp_stat="Approved" )then
            display "<td style='vertical-align: middle; background-color: #F0F0F0'>",
                    SVPInfoArr[i].prod_grp_desc clipped, "</td>"
            if( i mod 3=0 )then
               display "</tr><tr>"
            end if  #i mod
         end if
      end for  #G_SVPinfocnt
      display "</tr></table>"
   end if  #G_SVPinfocnt > 0



## display the Partner Program Status (may only be Storage)
if( URec.prog_status != ' ' and URec.prog_status is not NULL )then
#   display "<div style='text-align: left'>"
#   display "<span style='font-size: 8pt'><a href='https://www-356.ibm.com/partnerworld/wps/servlet/ContentHandler/isv_com_spe_storage' target='_blank'>", URec.prog_status clipped, " Partner</a></span></div>"
   display "<a href='https://www-356.ibm.com/partnerworld/wps/servlet/ContentHandler/isv_com_spe_storage' target='_blank'>", URec.prog_status clipped, " Partner</a><br>"
end if

## display the Partner Certification Status (may only be Storage)
if( CtlRec.showstoragecerts )then
   call GetStorageCertStr( BRec.b_id, URec.ceid ) returning retS1, retS2
   if( retS1 != ' ' )then
#      display "<div style='text-align: left'>"
      display "<a href='http://www-304.ibm.com/partnerworld/wps/servlet/ContentHandler/stg_com_tac-authorization' target='_blank'>", retS1 clipped, "</a><br>"
   end if
   if( retS2 != ' ' )then
#      display "<div style='text-align: left'>"
      display "<a href='http://www-304.ibm.com/partnerworld/wps/servlet/ContentHandler/stg_com_tac-authorization' target='_blank'>", retS2 clipped, "</a><br>"
   end if
end if  #CtlRec.showstoragecerts

## display the PW level and Value Pack
let pw_lev = GetPWLevel( URec.ceid )
if( pw_lev is not NULL )then
   display "<a href='", MasterRec.pw_url clipped, "' target='_blank'>PW Level:</a> ", pw_lev clipped, "<br>"
end if  #PW level

## show other brands
   if( CtlRec.showbrands )then
      display "<p>&nbsp;</p>"
      display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Details from Other Brands</strong>"
#      display "&nbsp;"
      display "<img onclick='detailPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Other Brand Explanation'></p>"
      display "<div class='popup' onclick='detailPopUp()'>"
      display "<div class='popuptext' id='DETAILPUP'><h2>Other Details Explanation</h2>"
      display MasterRec.details_txt clipped
      display "</div>"
      display "</div>"

      call ShowOtherBrands ( BRec.b_id, URec.ceid )
      display "</p>"
   end if  #showbrands


end if  # if show competency

display "</div>"

################################################################
## COMPETENCY SECTION END
################################################################

##-----------------------------------------------------------------------------------------------------
## Build COMPETENCY - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build SKILLS - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Skills' class='tab' style='padding: 10px; display: none;'>"

############################################
## Show skills for current brand here if requested
############################################
##

#try out merging multiple skills for new Cloud organization
if( BRec.b_id='AU' and URec.part_name matches 'Siri*') then
   let SQLStr="select a.*, b.ordctp, b.desc from brands a, unit_brand b where a.b_id=b.b_id and b.u_id in ('AU','SU') order by a.b_id, a.b_ord"
else  #production path
   let SQLStr="select a.*, b.ordctp, b.desc from brands a, unit_brand b where a.b_id=b.b_id and b.u_id='", BRec.b_id clipped, "' order by a.b_ord"
end if  #try out merging multiple skills for new Cloud organization

prepare LSU2 from SQLStr
declare LSU2Curs cursor for LSU2

## display skill legend
call DispSkillLegend( UpdateAllow )
foreach LSU2Curs into tBrandRec.*, tidx, tdesc
   let CTPArr[tidx] = tdesc
   let SkilledYN = LoadSkillRec( tBrandRec.b_id, URec.ceid )
   if( SkilledYN or UpdateAllow )then
      call ShowSkillsCurrentBrandS( tBrandRec.b_id, tBrandRec.b_ord )
   end if
end foreach

display "</div>"
##-----------------------------------------------------------------------------------------------------
## Build SKILLS - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build SOLUTIONS - START
##-----------------------------------------------------------------------------------------------------

############################################
## GSD Solutions (NO longer only for Secret pages)
############################################

display "<div id='Solutions' class='tab' style='padding: 10px; display: none;'>"

let gsdStr="select count(*) from gsd_solutions where ceid='", uRec.ceid clipped, "'"
prepare GSDID0 from gsdStr
execute GSDID0 into gcnt

   display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Repeatable Solution Information</strong>"
   display "&nbsp;"
   display "<img onclick='solutionPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Target Explanation'></p>"
   display "<div class='popup' onclick='solutionPopUp()'>"
   display "<div class='popuptext' id='SOLUTIONPUP'><h2>Solution Explanation</h2>"
   display MasterRec.sol_txt 
   display "</div>"
   display "</div>"

## proceed if there are solutions
if( gcnt>0 )then
   display "<table border='0' height='60' width='800' class='mytable' cellspacing='0' cellpadding='5'>"
   display "<tbody>"
#   display "<tr><td ;='' style='background-color: ", colorStr clipped, "; width: 400px; '>"

# before question mark
   display "<tr><td ;='' style='background-color: #F0F0F0; width: 400px; '>"
   display "<strong>", "Solution Name", "</strong></td>"

   display "<td ;='' style='background-color: #F0F0F0'>"
   display "<strong>", "Competencies", "</strong></td>"
   display "</tr>"

{
   display "<tr><td ;='' style='background-color: #F0F0F0; width: 400px; '>"
   display "<strong>", "Solution Name", "</strong>"
   display "</td><td style='vertical-align: top;'>"
display "<div class='popup' onclick='myFunction()'>"
   
display "<img onclick='myFunction()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Competency Explanation'>"
display "<span class='popuptext' id='myPopup'><h2>Competency Explanation</h2>"
display MasterRec.comp_txt
display "</span>"
display "</div>"
display "</td>"

   display "<td ;='' style='background-color: #F0F0F0'>"
   display "<strong>", "Competencies", "</strong></td>"
   display "</tr>"
}

#display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Competency Status</strong>"
#display "&nbsp;"
#display "<img onclick='myFunction()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Competency Explanation'></p>"
#display "<div class='popup' onclick='myFunction()'>"
#display "<div class='popuptext' id='myPopup'><h2>Competency Explanation</h2>"
#display MasterRec.comp_txt
#display "</div>"
#display "</div>"

   let gsdStr = "select a.* from gsd_solutions a where a.ceid='", uRec.ceid clipped, "' order by sol_name, sol_id, comp_name "

   prepare GSDID from gsdStr
   declare GSDCurs cursor for GSDID
   let gcnt=0
   foreach GSDCurs into GSDRec.*

      if( gcnt=0 )then
         let gcnt=gcnt+1
         initialize GSDArr[gcnt].* to NULL

         let GSDArr[gcnt].sol_id=GSDRec.sol_id clipped
         let GSDArr[gcnt].sol_name=GSDRec.sol_name clipped
         let GSDArr[gcnt].sol_url=GSDRec.sol_url clipped
         let GSDArr[gcnt].comp_name=GSDRec.comp_name clipped
      else
         if( GSDRec.sol_id = GSDArr[gcnt].sol_id )then
            if( GSDRec.comp_name != "UNASSIGNED" )then
               let GSDArr[gcnt].comp_name=GSDArr[gcnt].comp_name clipped, "<br>", GSDRec.comp_name clipped
            end if
#            let GSDArr[gcnt].comp_name=GSDArr[gcnt].comp_name clipped, "<br>", GSDRec.comp_name clipped
         else
            let gcnt=gcnt+1
            initialize GSDArr[gcnt].* to NULL
   
            let GSDArr[gcnt].sol_id=GSDRec.sol_id clipped
            let GSDArr[gcnt].sol_name=GSDRec.sol_name clipped
            let GSDArr[gcnt].sol_url=GSDRec.sol_url clipped
            let GSDArr[gcnt].comp_name=GSDRec.comp_name clipped
         end if  #same sol_id
      end if  #first time
   end foreach

   for i=1 to gcnt
      if( i>=1 )then   #and GSDArr[i].comp_name != "UNASSIGNED" )then
         display "<tr>"
         display "<td valign='top' style='width: 400px' class='bottomborder'>"
         display "<a href='http://www-356.ibm.com/partnerworld/gsd/solutiondetails.do?solution=", GSDArr[i].sol_id using "<<<<<<", "' target='_blank'>", GSDArr[i].sol_name clipped, "</a></td>"
   
         display "<td valign='top' style='width: 400px' class='bottomborder'>"
         display "", GSDArr[i].comp_name clipped, "</td>"

         display "</tr>"
      end if  #not UNASSIGNED
   end for

   display "</tbody></table>"

end if  #solutions exist
display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build SOLUTIONS - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build REFERENCES - START
##-----------------------------------------------------------------------------------------------------

display "<div id='References' class='tab' style='padding: 10px; display: none;'>"

############################################
## Success and Reference Section
############################################

{
## check on accreditation and write message as appropriate
if( G_Acccnt > 0 )then   #AccRec.ceid = CLRec.CEID )then
   display "<p>"
   display "<img src='/", IRec.i_id clipped, "/I/star1.jpg' width='61' heigth='51'/><em>", "** IBM Software Practice Accelerator: ACCREDITED ", G_AccList clipped,"</em></span></p>"
end if
display "<p>"
}

## retrieve and display successes
let successCnt = GetSuccesses( URec.ceid )

display "<p style='width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
display "<strong>References & Success Stories</strong>"
display "&nbsp;"
display "<img onclick='referencePopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Target Explanation'></p>"
display "<div class='popup' onclick='referencePopUp()'>"
display "<div class='popuptext' id='REFERENCEPUP'><h2>References & Success Stories Explanation</h2>"
display MasterRec.ref_txt 
display "</div>"
display "</div>"

# allow entry of a new record if in update mode
if( UpdateAllow )then
   display "<FORM ID='rss1' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Insert New Record'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=505>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
   display "You can ADD new rows here.</br>"
   display "Title: <INPUT NAME='s_title' TYPE=text SIZE=50>"
   display "  URL: <INPUT NAME='s_url' TYPE=text SIZE=100><br>"
   display "</FORM>"
end if

if( successCnt > 0)then
   if( UpdateAllow )then
      display "<FORM ID='rss2' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
      display "<INPUT TYPE=submit VALUE='Submit Changes'><br>"
      display "To DELETE a record, remove the Title for that record and pres Submit.<br />"
      display "To UPDATE a record, simply edit the text below and press Submit."
      display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=507>"
      display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"

   end if
   if( successCnt > 0 )then
      display "<p>"
      display "<ul>"
      for i = 1 to successCnt
         if( UpdateAllow )then
            if( SuccessArr[i].s_title is not NULL )then
               display "Title: <INPUT NAME='s_title' TYPE=text SIZE=50 VALUE='", SuccessArr[i].s_title clipped, "'>"
               display "  URL: <INPUT NAME='s_url' TYPE=text SIZE=100 VALUE='", SuccessArr[i].s_link clipped, "'><BR>"
            end if
         else
            display "<li><a href='", SuccessArr[i].s_link clipped, "' target='_blank'>", SuccessArr[i].s_title clipped,"</a></li>"
         end if
      end for
      display "</ul>"
   end if  #successCnt > 0

   if( UpdateAllow )then
      display "</FORM>"
   end if
end if
display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build REFERENCES - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build MARKETS - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Markets' class='tab' style='padding: 10px; display: none;'>"

############################################
## Market/Industry Section
############################################
if( UpdateAllow )then
   display "<FORM ID='ind' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Market/Industry Changes'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=503>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
end if
call DispMarketLegend( UpdateAllow )

{#before question mark
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
display "<strong>Market & Industry Experience</strong>"
display "</p>"
}

display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Market & Industry Experience</strong>"
display "&nbsp;"
display "<img onclick='marketPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Market & Industry Explanation'></p>"
display "<div class='popup' onclick='marketPopUp()'>"
display "<div class='popuptext' id='MIPUP'><h2>Market & Industry Explanation</h2>"
display MasterRec.mkt_txt 
display "</div>"
display "</div>"

display "<table border='0' width='744px'>"
display "<tbody>"

############################################
## NEW Industry Section
############################################

call GetINDDetails()
let i = 1
let j = 1
while i <= G_INDcnt
   let newi = i
   let oMarket = INDArr[i].ig_name
#   display "G_INDcnt: ", G_INDcnt, "<br>"
#   display i, "Calling PlayInMarket for: ", MKArr[i].m_name clipped, "  Market: ", INDArr[i].ig_name clipped, "<br>"
   let tRcnt=PlayInMarket( INDArr[i].ig_name )
#   if( tRcnt>0 )then display "Market: ", INDArr[i].ig_name clipped, "<br>" end if
#   let tRcnt=PlayInMarket( MKArr[i].m_name )
#display "tRcnt: ", tRcnt, "<br>"
#if( (URec.ceid='18z7gkgl' or URec.ceid='18z7821h') and tRcnt>0)then
if( tRcnt>0 or UpdateAllow )then

   if( INDArr[i].i_name != "<none>" )then
      display "<tr><td>"
      display "<table cellspacing='0' border='0' style='padding-left: 10px;' class='mytable'>"
      display "<tbody>"
 
      display "<tr><td colspan='1' style='width: 350px; vertical-align: top;' class='bottomborder'>"
      display "<strong>", INDArr[i].ig_name clipped, "</strong></td>"
      display "<td class='bottomborder'>"
      display "<table width='450' cellspacing='0' class='mytable'>"
   end if
      while oMarket = INDArr[i].ig_name
         if( EUArr[i].e_name != "<none>" )then
            if ((INDDetails[i]='Y' or INDDetails[i]='1' or INDDetails[i]='2' or INDDetails[i]='3' or INDDetails[i]='4'))then
               display "<tr><td class='bottomborder2' width='300'>", INDarr[i].i_name clipped, "</td>"
               display "<td class='bottomborder2' width='50'>&nbsp;</td>"
               display "<td class='' width='150'>"
#display "INDDetails[i]: ", INDDetails[i]
               if( INDDetails[i]='Y' )then
                  let starmax=1
               else
                  let starmax=INDDetails[i]
               end if  #is it a Y
               if( starmax >3 )then
                  let starmax=3
               else 
                  if( starmax < 1 or  starmax is null )then
                     let starmax=0
                  end if
               end if
               if( UpdateAllow )then
#                  display "<INPUT NAME='", INDColNamesArr[ newi ].i_col clipped, "' VALUE=", starmax,"><br>"
##                correct following line, #317
                  display "<INPUT NAME='", INDColNamesArr[ i ].i_col clipped, "' VALUE=", starmax,"><br>"
               else
                  for starcnt=1 to starmax
                     display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>"
                  end for
                  for starcnt=1 to (3-starmax)
                     display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>"
                  end for
               end if  #UpdateAllow
               display "</tr>"
            else
               if( UpdateAllow )then
                  display "<tr><td class='bottomborder2' width='300'>", INDarr[i].i_name clipped, "</td>"
                  display "<td class='bottomborder2' width='50'>&nbsp;</td>"
                  display "<td class='' width='150'>"
                  display "<INPUT NAME='", INDColNamesArr[i].i_col clipped, "' VALUE=''><br>"
               end if
            end if  #has valid number
         end if  #not empty
         let i = i + 1
      end while
      display "</table>"
   let j = i   #remember the new starting point to reset later

   display "</table>"

   display "</tr>"

   let i = j  #new starting point set above
else
   let i=i+1
end if  #tRcnt
end while

display "</td></tr>"

if( UpdateAllow )then
# provide empty entry for inserting

# close out the FORM
   display "</FORM>"
end if
display "</tbody>"
display "</table>"
display "<br />"
display "<p>"

## end of NEW Industry Section
display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build MARKETS - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build GEOGRAPHY - START
##-----------------------------------------------------------------------------------------------------

display "<div id='Geographies' class='tab' style='padding: 10px; display: none;'>"
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
display "<strong>Geographical Coverage</strong>"
display "&nbsp;"
display "<img onclick='geoPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Geographical Explanation'></p>"
display "<div class='popup' onclick='geoPopUp()'>"
display "<div class='popuptext' id='GPUP'><h2>Geographical Coverage Explanation</h2>"
display MasterRec.geo_txt 
display "</div>"
display "</div>"
############################################
## Enterprise Unit Section
############################################
call GetEUDetails()

## set up table for list of enterprise units
if( UpdateAllow )then
   display "<FORM ID='eu' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Geography Changes'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=502>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
end if

display "<table border='0' width='744'>"
display "<tbody>"

## separate by regions
let i = 1
let j = 1

while i <= G_EUcnt
   let newi = i
   let oRegion = EUArr[i].e_region
   let tRcnt=PlayInRegion( EUArr[i].e_region )
#display oRegion, " ", tRcnt, "<br>"
####NEEDS SOMETHING DONE HERE TO SHOW ALL RGIONS WHEN UPDATE MODE
   if( tRcnt > 0 or UpdateAllow )then
   if( EUArr[i].e_name != "<none>" )then
      display "<tr><td>"
      display "<table cellspacing='0' border='0' style='padding-left: 10px;' class='mytable'>"
      display "<tbody>"

      display "<tr><td colspan='1' style='width: 350px; vertical-align: top;' class='bottomborder'>"
      display "<strong>", EUarr[i].e_region clipped, "</strong></td>"
      display "<td class='bottomborder'>"
      display "<table width='450' cellspacing='0' class='mytable'>"
   end if
      while oRegion = EUArr[i].e_region
         if( EUArr[i].e_name != "<none>" )then
            if( EUDetails[i] = "Y" or EUDetails[i]="H" )then
               if( UpdateAllow )then
                  display "<tr><td width='300'>", EUArr[i].e_name clipped, "</td>"
                  display "<td><INPUT NAME='", EUColNamesArr[i].colname clipped, "' VALUE=", EUDetails[i] clipped,"></td>"
               else
                  display "<tr><td width='300'>", EUArr[i].e_name clipped, "</td>"
               end if
#               display "<tr><td class='bottomborder2' width='300'>", EUArr[i].e_name clipped, "</td>"
#               display "<td class='bottomborder2' width='50'>&nbsp;</td>"
#               let buStr = BUText( EUDetails[i] clipped )
#               display "<td class='' width='150'>", buStr clipped
               display "</tr>"
            else
               if( UpdateAllow )then
                  display "<tr><td width='300'>", EUArr[i].e_name clipped, "</td>"
                  display "<td><INPUT NAME='", EUColNamesArr[i].colname clipped, "' VALUE='", EUDetails[i] clipped,"'></td>"
                  display "</tr>"
               end if

            end if  #available EU
         end if
         let i = i + 1
      end while
      display "</table>"
   let j = i   #remember the new starting point to reset later

   display "</table>"

   
   display "</tr>"

   else
      let i=i+1
      let j=i
   end if  #available region
   let i = j  #new starting point set above

end while

if( UpdateAllow )then
# provide empty entry for inserting

# close out the FORM
   display "</FORM>"
end if
display "</tbody>"
display "</table>"

## display headquarters
if( URec.hq is not NULL )then
   let stateStr = GetState( URec.hq clipped )
   if( stateStr is not NULL )then
      display "<p>"
      display "<strong>Headquartered</strong>: ", stateStr clipped
      display "</p>"
   else
      display "<p>"
      display "&nbsp;</p>"
   end if
else
   display "<p>"
   display "&nbsp;</p>"
end if

display "</div>"


##-----------------------------------------------------------------------------------------------------
## Build GEOGRAPHY - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build CONTACTS - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Contacts' class='tab' style='display:none'>"

############################################
## Contact Section
############################################
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
display "<strong>IBM and Partner primary contacts</strong>"
display "</p>"

## partner contacts
display "<table>"
display "<tr><td valign='top'>"
display "<table cellpadding='0' style='width: 400px' class='mytable'>"
display "<tr>"
display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
display "<td><strong>Primary PARTNER Sales Contact</strong></td>"
display "</tr>"
#let UpdateAllow = FALSE
if( UpdateAllow )then
   display "<tr><td><FORM ID='cont' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Contact Changes'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=504>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
end if

if( URec.p_name is not null and URec.p_name != " " ) then
   if( UpdateAllow )then
      display "Name: <INPUT NAME='p_name' TYPE=text VALUE='", URec.p_name clipped, "' size='30'><br>"
   else
      display "<tr>"
      if( URec.p_email is not null and URec.p_email != " " )then
         display "<td><a href='mailto:", URec.p_email clipped, "' style='position: relative' target='_blank'>", URec.p_name clipped, "</a></td>"
      else
         display "<td>", URec.p_name clipped, "</td>"
      end if  #valid email
      display "</tr>"
   end if
else
   if( UpdateAllow )then
      display "Name: <INPUT NAME='p_name' TYPE='text' size='30'><br>"
   end if
end if  #p_name

   if( URec.p_title is not null ) then
      if( UpdateAllow )then
         display "Title: <INPUT NAME='p_title' TYPE='text' VALUE='", URec.p_title clipped, "' size='30'><br>"
      else
         display "<tr><td>", URec.p_title clipped, "</td></tr>"
      end if
   else
      if( UpdateAllow )then
         display "Title: <INPUT NAME='p_title' TYPE='text' size='30'><br>"
      end if
   end if  #p_title
   
   if( URec.p_phone is not null ) then
      if( UpdateAllow )then
         display  "Phone: <INPUT NAME='p_phone' TYPE='text' VALUE='", URec.p_phone clipped, "' size='30'><br>"
      else
         display "<tr><td>", URec.p_phone clipped, "</td></tr>"
      end if
   else
      if( UpdateAllow )then
         display  "Phone: <INPUT NAME='p_phone' TYPE='text' size='30'><br>"
      end if
   end if  #p_phone
   
   if( URec.p_email is not null ) then
      if( UpdateAllow )then
         display  "Email: <INPUT NAME='p_email' TYPE='email' VALUE='", URec.p_email clipped, "' size='30'><br>"
      else
#         display "<tr><td><a href='mailto:", URec.p_email clipped, "' style='position: relative' target='_blank'>", URec.p_email clipped, "</a></td></tr>"
      end if
   else
      if( UpdateAllow )then
         display  "Email: <INPUT NAME='p_email' TYPE='email' size='30'></span></span></div><br>"
      end if
   end if  #p_email

   if( UpdateAllow )then
      display "</FORM></td></tr>"
   end if

   display "</table>"
   display "</td>"
   display "<td valign='top'>"

   display "<table cellpadding='0' style='width: 400px' class='mytable'>"
   display "<tr>"
   display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
   display "<td><strong>", bprStr clipped, "</strong></td>"
   display "</tr>"
  
   if( URec.ssr is not null ) then
      display "<tr><td><a href='", SSRRec.r_link clipped, "' style='position: relative' target='_blank'>", SSRRec.r_name clipped, "</a></td></tr>"
   end if

########################################
## check for and display other IBM contacts
#            if( URec.ceid='18z7821h' )then  #testing with one partner
               if( URec.ctp1 is not null and URec.ctp1 != " " )then
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>", tssStr clipped, "</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", CTP1Rec.r_link clipped, "' style='position: relative' target='_blank'>", CTP1Rec.r_name clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
               if( URec.ctp2 is not null and URec.ctp2 != " " and URec.ctp2 != URec.ctp1 )then
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>", tssStr clipped, "</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", CTP2Rec.r_link clipped, "' style='position: relative' target='_blank'>", CTP2Rec.r_name clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
               if( URec.ctp3 is not null and URec.ctp3 != " " and URec.ctp3 != URec.ctp1 and URec.ctp3 != URec.ctp2 )then
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>", tssStr clipped, "</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", CTP3Rec.r_link clipped, "' style='position: relative' target='_blank'>", CTP3Rec.r_name clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
               if( URec.ctp4 is not null and URec.ctp4 != " " and URec.ctp4 != URec.ctp1 and URec.ctp4 != URec.ctp2 and URec.ctp4 != URec.ctp3 )then
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>", tssStr clipped, "</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", CTP4Rec.r_link clipped, "' style='position: relative' target='_blank'>", CTP4Rec.r_name clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
               if( URec.ctp5 is not null and URec.ctp5 != " " and URec.ctp5 != URec.ctp1 and URec.ctp5 != URec.ctp2 and URec.ctp5 != URec.ctp3 and URec.ctp5 != URec.ctp4 )then
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>", tssStr clipped, "</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", CTP5Rec.r_link clipped, "' style='position: relative' target='_blank'>", CTP5Rec.r_name clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
#              show cross-brand contacts

               if( CtlRec.showcrossflg and CRec.spr_power is not null and CRec.spr_power != " " )then
                  let lstr = getRepLink(CRec.spr_power)
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>SPR-Power</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", lstr clipped, "' style='position: relative' target='_blank'>", CRec.spr_power clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if
               if( CtlRec.showcrossflg and CRec.pta_hw is not null and CRec.pta_hw != " " )then
                  let lstr = getRepLink(CRec.pta_hw)
                  display "</table>"
#                  display "<td valign='top'>"
                  display "<table cellpadding='0' style='width: 400px' class='mytable'>"
                  display "<tr>"
                  display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
                  display "<td><strong>PTA-Power</strong></td>"
                  display "</tr>"
                  display "<tr>"
                  display "<td><a href='", lstr clipped, "' style='position: relative' target='_blank'>", CRec.pta_hw clipped, "</a></td>"
                  display "</td>"
                  display "</tr>"
               end if

#            end if  ##testing with one partner
########################################

## added if not showing other contacts
   display "</table>"
   display "</table>"

## show other contacts
   if( G_add_contacts)then
      call LoadContactArr( URec.ceid )

      if( G_ContactCnt > 0 or UpdateAllow )then

         display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
         display "<strong>Other contacts</strong>"
         display "</p>"

         display "<table>"
         let flg1=FALSE
         let flg2=FALSE
         let flg3=FALSE
         let flg4=FALSE
         let flg5=FALSE

         if( UpdateAllow )then
            display "<tr><td>"
            display "<FORM ID='opc' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
            display "<INPUT TYPE=submit VALUE='Submit Other Contact Changes'><br>"
            display "To DELETE a record, remove the NAME for that record and press Submit.<br> "
            display "To UPDATE a record, simply edit the text below and press Submit.<br>"
            display "To ADD a record, simply enter the contact information in the blank section below and press Submit."
            display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=510>"
            display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"></td></tr>"
         end if
 
         for c = 1 to G_ContactCnt
            display "<tr><td valign='top'>"
            display "<table cellpadding='0' style='width: 400px' class='mytable'>"
            display "<tr>"
            display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
            display "</tr>"
            display "<tr>"
            if( UpdateAllow )then
               display "<td>"
               display "NAME: <INPUT NAME='c_name' TYPE=text SIZE=30 VALUE='", ContactArr[c].c_name clipped, "'><br>"
               display "TITLE: <INPUT NAME='c_title' TYPE=text SIZE=40 VALUE='", ContactArr[c].c_title clipped, "'><br>"
               display "PHONE: <INPUT NAME='c_phone' TYPE=text SIZE=30 VALUE='", ContactArr[c].c_phone clipped, "'><br>"
               display "EMAIL: <INPUT NAME='c_phone' TYPE=text SIZE=50 VALUE='", ContactArr[c].c_email clipped, "'><br>"
               display "</td>"
            else
               if( ContactArr[c].c_email is not null and ContactArr[c].c_email != " " )then
                  display "<td><a href='mailto:", ContactArr[c].c_email clipped, "' style='position: relative' target='_blank'>", ContactArr[c].c_name clipped, "</a></td>"
               else
                  display "<td>", ContactArr[c].c_name clipped, "</td>"
               end if  #email present
               display "</tr>"
               display "<tr><td>", ContactArr[c].c_title clipped, "</td></tr>"
               display "<tr><td>", ContactArr[c].c_phone clipped, "</td></tr>"
            end if  #UpdateAllow

            display "</table>"
            display "</td>"

            display "</tr>"
         end for  #c

         if( UpdateAllow )then
            display "<tr><td valign='top'>"
            display "<table cellpadding='0' style='width: 400px' class='mytable'>"
            display "<tr>"
            display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
            display "</tr>"
            display "<tr>"
            display "<td>"
            display "NAME: <INPUT NAME='c_name' TYPE=text SIZE=30 VALUE=' '><br>"
            display "TITLE: <INPUT NAME='c_title' TYPE=text SIZE=40 VALUE=' '><br>"
            display "PHONE: <INPUT NAME='c_phone' TYPE=text SIZE=30 VALUE=' '><br>"
            display "EMAIL: <INPUT NAME='c_phone' TYPE=text SIZE=50 VALUE=' '><br>"
	    display "</td></tr>"
	    display "</table>"
            display "</td>"
            display "</tr>"
         end if  #update allow

         display "</td>"
         display "</table>"

         if( UpdateAllow )then
            display "</FORM>"
         end if

      end if #G_ContactCnt>0
 
   end if  #G_add_contacts

## end of section
   display "</div>"

#end if

##-----------------------------------------------------------------------------------------------------
## Build CONTACTS - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build CERTIFICATIONS - START
##-----------------------------------------------------------------------------------------------------
if( CtlRec.showcerts )then

   display "<div id='Certifications' class='tab' style='display:none'>"

   let G_CertCnt = GetCerts2( BRec.b_id, URec.ceid )


   let showTableHeader = TRUE
   let lastRag = "<none>"

   for i = 1 to G_CertCnt 

      if( lastRag != CertArr[i].prod_group )then
         if( i>1 )then
            display "</table>"
            display "</td></tr>"
            display "</table>"
         end if  #i>1
#         display "</table>"
#         display "</td></tr>"
         display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>", CertArr[i].prod_group clipped, "</strong>"
         display "</p>"
         display "<table border='0' width='700'>"
         display "<tbody>"
         call CertCount(URec.ceid, CertArr[i].prod_group ) returning Scnt, Tcnt

#         display "<tr><td colspan='1' style='width: 200px; vertical-align: top;' class='bottomborder'>"
         display "<tr><td>"
         display "<table cellspacing='0' border='0' style='padding-left: 10px' class='mytable'>"
         display "<tbody><tr>"
         display "<td class='bottomborder2' width='100' style='height: 25px'><strong>Cert Type</strong></td>"
         display "<td class='bottomborder2' width='500' style='height: 25px'><strong>Cert Description</strong></td>"
         display "<td class='bottomborder2' width='100' style='height: 25px'><strong>Sunset Date</strong></td>"
         display "<td class='bottomborder2' width='100' style='height: 25px;text-align: center;'><strong># Certs</strong></td>"
         display "</tr>"
#	 display "<table border='1'>"
#	 display "<tr>"
#         display "</tr>"
      end if  #not the same prod group as last time

      display "<tr>"
      display "<td class='bottomborder2' width='100' style='height: 25px'>",CertArr[i].cert_type clipped, "</td>"
      display "<td class='bottomborder2' width='500' style='height: 25px'>",CertArr[i].cert_desc clipped, "</td>"
      display "<td class='bottomborder2' width='100' style='height: 25px'>",CertArr[i].sunset_dt clipped, "</td>"
      display "<td class='bottomborder2' width='100' style='height: 25px;text-align: center;'>",CertArr[i].cnt clipped, "</td>"
      display "</tr>"

      let lastRAG = CertArr[i].prod_group
   
   end for

   display "</table>"
   display "</td></tr>"
   display "</table>"

end if  #CtlRec.showcerts

display "</div>"

##-----------------------------------------------------------------------------------------------------
## Build CERTIFICATIONS - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build PLANNING - START
##-----------------------------------------------------------------------------------------------------

############################################
## Activity Tracking Section
############################################
#if( CtlRec.showplanning and CLRec.CEID='18z7gkgl' )then
if( CtlRec.showplanning or (BRec.b_id='NC' and URec.ceid='18z7gkgl') )then
display "<div id='Planning' class='tab' style='display:none'>"

############################################
## Activity Section
############################################
display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'>"
display "<strong>", CtlRec.menu_str clipped, " Activity Initiatives</strong>"
display "</p>"

## select statements
let SQLStr1 = "select a.*, b.part_name from ", CtlRec.act_init_tab clipped, " a, ", cov_tab clipped, " b where a.ceid='", CLRec.CEID clipped, "' and a.ceid=b.ceid "
let SQLStr2 = "select b.* from ", CtlRec.act_tab clipped, " b where b.ceid='", CLRec.CEID clipped, "' ",
              "and b.act_stat != 'A' ", 
              "order by b.act_st_dt "

if( UpdateAllow )then
   display "<FORM ID='actinit' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Initiatives'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=751>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
end if

prepare FCID from SQLStr1
execute FCID into ActInitRec.*, tmp_pname

let i=1

   display "<table>"
   display "<tr><td valign='top'>"
   display "<table cellpadding='0' style='width: 400px' class='mytable'>"
   display "<tr>"
   display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
   display "<td><strong>Partner Initiatives</strong></td>"
#   display "<td>BP Initiatives</td>"
   display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
   display "<td><strong>", BRec.b_name clipped, " Initiatives</strong></td></tr>"

#   display "</tr>"
  
   if( UpdateAllow )then
      display "<tr><td><INPUT NAME='bp_init1' SIZE='60' VALUE='", ActInitRec.bp_init1 clipped,"'>",
              "</td><td class='centerText'>";
   else
      display "<tr><td class='centerText'>", ActInitRec.bp_init1 clipped, "</td>";
   end if

   if( UpdateAllow )then
      display "<td><INPUT NAME='st_init1' SIZE='60' VALUE='", ActInitRec.st_init1 clipped,"'>",
              "</td></tr>"
   else
      display "<td class='centerText'>", ActInitRec.st_init1 clipped, "</td></tr>";
   end if

   if( UpdateAllow )then
      display "<tr><td><INPUT NAME='bp_init2' SIZE='60' VALUE='", ActInitRec.bp_init2 clipped,"'>",
              "</td><td class='centerText'>";
   else
      display "<tr><td class='centerText'>", ActInitRec.bp_init2 clipped, "</td>";
   end if

   if( UpdateAllow )then
      display "<td><INPUT NAME='st_init2' SIZE='60' VALUE='", ActInitRec.st_init2 clipped,"'>",
              "</td></tr>"
   else
      display "<td class='centerText'>", ActInitRec.st_init2 clipped, "</td></tr>";
   end if

   if( UpdateAllow )then
      display "<tr><td><INPUT NAME='bp_init3' SIZE='60' VALUE='", ActInitRec.bp_init3 clipped,"'>",
              "</td><td class='centerText'>";
   else
      display "<tr><td class='centerText'>", ActInitRec.bp_init3 clipped, "</td>";
   end if

   if( UpdateAllow )then
      display "<td><INPUT NAME='st_init3' SIZE='60' VALUE='", ActInitRec.st_init3 clipped,"'>",
              "</td></tr>"
   else
      display "<td class='centerText'>", ActInitRec.st_init3 clipped, "</td></tr>";
   end if

   display "</table>"
   display "</table>"
   display "</td>"
   display "<td valign='top'>"

{
   display "<table cellpadding='0' style='width: 400px' class='mytable'>"
   display "<tr>"
   display "<td style='width: 21px; background: #add8e6' rowspan='4'>&nbsp;</td>"
   display "<td><strong> ", BRec.b_name clipped, " Initiatives</strong></td>"


   display "</tr>"
   display "</table>"
}

# close out the FORM
   if( UpdateAllow )then
      display "</FORM>"
   end if

#   display "<tr><td class='centerText'>", ActInitRec.bp_init2 clipped, "</td><td class='centerText'>", ActInitRec.st_init2 clipped, "</td></tr>"
#   display "<tr><td class='centerText'>", ActInitRec.bp_init3 clipped, "</td><td class='centerText'>", ActInitRec.st_init3 clipped, "</td></tr>"

if( UpdateAllow )then
   display "<FORM ID='actvity' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Activities'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=752>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
end if

#   display "<table>"
#   display "<tr></tr>"
#display SQLStr2
   prepare FC2ID from SQLStr2
   declare FC2Curs cursor for FC2ID

display "<div style='white-space:pre;overflow:auto;width:1000;padding:10px;'>"
   display "<table style='font-size:12px; border-color: light-gray; border: 1px;' ;='' border='1' height='127' cellspaces='0' cellpadding='5'>"
   display "<tbody>"
   display "<tr><th style='text-align: center; background-color: #add8e6; width: 150px'><strong>Activity Name</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 150px'><strong>Activity Description</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 130px'><strong>Activity Type</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>Associated Initiative</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>Status Name</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>Revenue ($k)</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>State Date</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>End Date</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>IBM Owner</strong></th>"
   display "<th style='text-align: center; background-color: #add8e6; width: 100px'><strong>BP Owner</strong></th>"
   display "</tr><tr>"


   foreach FC2Curs into ActRec.*
      case ActRec.act_code
         when "D"
            let type_desc="Ecosystem Development"
         when "E"
            let type_desc="Enablement"
         when "M"
            let type_desc="Marketing"
         when "O"
            let type_desc="Opportunity Identification"
         when "P"
            let type_desc="Deal Progression"

      end case

      case ActRec.act_stat
         when "S"
            let stat_desc="Started"
         when "I"
            let stat_desc="In-Process"
         when "C"
            let stat_desc="Completed"
      end case

      display "<tr><td class='leftText' style='width: 500'>";
      if( UpdateAllow )then
#         display "<INPUT NAME='id' TYPE=hidden READONLY VALUE=", ActRec.act_sn, "><INPUT NAME='act_name' SIZE='60' VALUE='", ActRec.act_name clipped,"'>";
         display "<INPUT NAME='id' TYPE=hidden READONLY VALUE=", ActRec.act_sn, "><TEXTAREA NAME='act_name' rows='2' cols='30'>", ActRec.act_name clipped, "</TEXTAREA>"
#         display "<INPUT NAME='act_name' SIZE='60' VALUE='", ActRec.act_name clipped,"'>";
      else
         display ActRec.act_name clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      if( UpdateAllow )then
#         display "<INPUT NAME='act_desc' SIZE='60' VALUE='", ActRec.act_desc clipped,"'>";
         display "<TEXTAREA NAME='act_desc' rows='3' cols='30'>", ActRec.act_desc clipped, "</TEXTAREA>"

      else
         display ActRec.act_desc clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      if( UpdateAllow )then
         call ListBoxActType( ActRec.act_code )
      else
         display type_desc clipped
      end if
#      if( UpdateAllow )then
#     ma
#         display "<INPUT NAME='act_code' SIZE='60' VALUE='", ActRec.act_desc clipped,"'>";
#      else
#         display ActRec.act_desc clipped;
#      end if
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      if( UpdateAllow )then
         call ListBoxActInit( ActRec.act_init )
      else
         display ActRec.act_init clipped
      end if
      display "</td>"

#	      "<td style='width: 500'>",ActRec.act_init clipped, "</td>",

      display "<td class='leftText' style='width: 500'>";
      if( UpdateAllow )then
         call ListBoxActStatus( ActRec.act_stat )
      else
         display stat_desc clipped
      end if
      display "</td>"
#	      "<td>",stat_desc clipped, "</td>",

      display "<td class='leftText' style='width: 200'>";
      if( UpdateAllow )then
         display "<INPUT NAME='act_rev' SIZE='10' VALUE='", ActRec.act_rev clipped,"'>";
      else
         display ActRec.act_rev clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      if( UpdateAllow )then
         display "<INPUT NAME='act_st_dt' SIZE='10' VALUE='", ActRec.act_st_dt clipped,"'>";
      else
         display ActRec.act_st_dt clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      if( UpdateAllow )then
         display "<INPUT NAME='act_ed_dt' SIZE='10' VALUE='", ActRec.act_ed_dt clipped,"'>";
      else
         display ActRec.act_ed_dt clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      if( UpdateAllow )then
         display "<INPUT NAME='act_own_ibm' SIZE='25' VALUE='", ActRec.act_own_ibm clipped,"'>";
      else
         display ActRec.act_own_ibm clipped;
      end if
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      if( UpdateAllow )then
         display "<INPUT NAME='act_own_bp' SIZE='25' VALUE='", ActRec.act_own_bp clipped,"'>";
      else
         display ActRec.act_own_bp clipped;
      end if
      display "</td>"
      display "</tr>"

   end foreach


#end foreach

## show empty line for new data
   if( UpdateAllow )then
      display "<tr><td class='leftText' style='width: 500'>";
      display "<INPUT NAME='id' TYPE=hidden READONLY VALUE=0><TEXTAREA NAME='act_name' rows='2' cols='30'>(new record)</TEXTAREA>"
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      display "<TEXTAREA NAME='act_desc' rows='3' cols='30'></TEXTAREA>"
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      call ListBoxActType( "D" )
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      call ListBoxActInit( "" )
      display "</td>"

      display "<td class='leftText' style='width: 500'>";
      call ListBoxActStatus( "" )
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      display "<INPUT NAME='act_rev' SIZE='10' VALUE='0'>";
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      display "<INPUT NAME='act_st_dt' SIZE='10' VALUE=''>";
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      display "<INPUT NAME='act_ed_dt' SIZE='10' VALUE=''>";
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      display "<INPUT NAME='act_own_ibm' SIZE='25' VALUE=''>";
      display "</td>"

      display "<td class='leftText' style='width: 200'>";
      display "<INPUT NAME='act_own_bp' SIZE='25' VALUE=''>";
      display "</td>"
      display "</tr>"
   end if  #updateallow for blank line

   display "</table>"  #inner
   display "</div>"  #needed for scroll bar

# close out the FORM
   if( UpdateAllow )then
      display "</FORM>"
   end if

   display "<br />"
   display "<p>"
   display "&nbsp;</p>"
   display "</td>"
   display "</tr>"
display "</div>"
end if  #if showplanning
##-----------------------------------------------------------------------------------------------------
## Build PLANNING - END
##-----------------------------------------------------------------------------------------------------

##-----------------------------------------------------------------------------------------------------
## Build OTHER - START
##-----------------------------------------------------------------------------------------------------
display "<div id='Other' class='tab' style='display:none'>"

#display "Partner Matrix Revision: ", V_Num clipped, "<br/>"

call LastUpdt(BRec.b_id) returning lastDtRec.*
if( lastDtRec.mo is not NULL and not UpdateAllow )then
   display MasterRec.updmsg clipped, ": ", lastDtRec.mo using "&&", "/", lastDtRec.dy using "&&", "/", lastDtRec.yr using "&&&&", " - ", lastDtRec.hrmi
end if

display "<p dir='ltr' style='font-size:18px;text-align: left;'><a href='http://ibm.biz/PartnerMatrixBlog' target='_blank'>Partner Matrix Blog</a><br/>"
display "</p>"


## allow edit of misc fields
if( UpdateAllow )then
   display "<FORM ID='eu' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Changes Below'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=506>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"

   display "Alternative Name: <INPUT NAME='part_name_abbr' SIZE=30 VALUE='", URec.part_name_abbr clipped,"'><br>"
   display "HQ: <INPUT NAME='hq' SIZE=2 VALUE=", URec.hq clipped,"><br>"
   call ListBoxSegment( URec.part_type )
#   display "SEGMENT: <SELECT NAME='part_type'><OPTION SELECTED>", URec.part_type clipped,"</SELECT><br>"
#   display "SEGMENT: <INPUT NAME='part_type' SIZE=1 VALUE=", URec.part_type clipped,"><br>"
   call ListBoxReseller( URec.reseller )
#   display "RESELLER CODE (Reseller, Not): <SELECT NAME='reseller'><OPTION SELECTED>", URec.reseller clipped, "<OPTION>N</SELECT><br>"
#   display "RESELLER CODE (R-Reseller, N-Not (N will remove from Matrix): <INPUT NAME='reseller' SIZE=1 VALUE=", URec.reseller clipped,"><br>"
   call ListBoxVAD( URec.vad )
#   display "VAD: <INPUT NAME='vad' VALUE=", URec.vad clipped,"><br>"
#   call ListBoxPOD( URec.pod )
   display "URL: <INPUT NAME='url' SIZE=50 VALUE='", URec.url clipped,"'><br>"
   display "PartnerWorld Profile URL: <INPUT NAME='pwp' SIZE=100 VALUE='", URec.pwp clipped,"'><br>"
#   display "Hunter? : <INPUT NAME='hunter' VALUE='", URec.hunter clipped,"'><br>"
   display "<br>"
   call ListBoxHunter( URec.hunter )
#   display "Commercial? : <INPUT NAME='commercial' VALUE='", URec.commercial clipped,"'><br>"
   call ListBoxCommercial( URec.commercial )
   call ListBoxEnterprise( URec.enterprise )
   call ListBoxIndustry( URec.industry )
   call ListBoxLAP( URec.lap )
   call ListBoxDFM( URec.dfm )
   call ListBoxPartnersWell( URec.partners_well )
   display "<br>"
   display "Other Focus Area #1: <INPUT NAME='focus1' VALUE='", URec.focus1 clipped,"'><br>"
   display "Other Focus Area #2: <INPUT NAME='focus2' VALUE='", URec.focus2 clipped,"'><br>"
   display "Other Focus Area #3: <INPUT NAME='focus3' VALUE='", URec.focus3 clipped,"'><br>"
   display "<br>"
   call ListBoxSSR( URec.ssr, bprStr )
#   display "BPR: <INPUT NAME='ssr' SIZE=30 VALUE='", URec.ssr clipped,"'><br>"

   let ctp_cnt = LoadUnitBrand( BRec.b_id )
   call ListBoxCTP1( URec.ctp1 )
   call ListBoxCTP2( URec.ctp2 )
   call ListBoxCTP3( URec.ctp3 )
   call ListBoxCTP4( URec.ctp4 )
   call ListBoxCTP5( URec.ctp5 )
#   display "TSS #1 (", UnitBrandArr[1].b_id clipped, "): <INPUT NAME='ctp1' SIZE=30 VALUE='", URec.ctp1 clipped,"'><br>"
#   display "TSS #2 (",  UnitBrandArr[2].b_id clipped, "): <INPUT NAME='ctp2' SIZE=30 VALUE='", URec.ctp2 clipped,"'><br>"
#   display "TSS #3 (",  UnitBrandArr[3].b_id clipped, "): <INPUT NAME='ctp3' SIZE=30 VALUE='", URec.ctp3 clipped,"'><br>"
#   display "TSS #4 (",  UnitBrandArr[4].b_id clipped, "): <INPUT NAME='ctp4' SIZE=30 VALUE='", URec.ctp4 clipped,"'><br>"
#   display "TSS #5 (",  UnitBrandArr[5].b_id clipped, "): <INPUT NAME='ctp5' SIZE=30 VALUE='", URec.ctp5 clipped,"'><br>"
   display "</FORM>"
end if

# cross-brand
if( UpdateAllow and CtlRec.showcrossflg )then
#display "CREC: ", CRec.*
   if( CtlRec.showextend_st AND (CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " ))then
      display "<FORM ID='eu' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
      display "<INPUT TYPE=submit VALUE='Submit Changes Below'>"
      display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=512>"
      display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
      if( CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " )then
         
#         if( CtlRec.showflash )then
#            call ListBoxFlash( CRec.flash )
#         end if
         if( CtlRec.showspr )then
#same as cov.ssr   call ListBoxSPR( CRec.spr )
#not needed        call ListBoxSPRHW( CRec.spr_hw )
            call ListBoxSPRPower( CRec.spr_power )
         end if
         if( CtlRec.showpta )then
            call ListBoxPTA( CRec.pta )
            call ListBoxPTAPower( CRec.pta_hw )
         end if
## PCR SHOULD BE UPDATED IN POD TABLE NOT CROSS TABLE
#         if( CtlRec.showpcr )then
#            call ListBoxPCR( CRec.pcr )
#         end if
         if( CtlRec.showzrep )then
            call ListBoxzRep( CRec.zrep )
         end if
      end if
      display "</FORM>"
   end if
end if  #updateAllow - form 512

if( UpdateAllow )then
   if( CtlRec.showswita AND CtlRec.showcrossflg AND (CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " ))then
      display "<FORM ID='eu' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
      display "<INPUT TYPE=submit VALUE='Submit Changes Below'>"
      display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=513>"
      display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
      if( CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " )then
         if( CtlRec.showswita )then
            call ListBoxSWITA( CRec.swita )
         end if
      end if
      display "</FORM>"
   end if
end if   #updateAllow - form 513

if( UpdateAllow )then
   if( URec.reseller =  'G' AND CtlRec.showalliance AND (CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " ))then
      display "<FORM ID='eu' ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
      display "<INPUT TYPE=submit VALUE='Submit Changes Below'>"
      display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=514>"
      display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
      if( CtlRec.coverextend_tab is not NULL and CtlRec.coverextend_tab != " " )then
         if( CtlRec.showalliance )then
            call ListBoxAllianceBPR( CRec.alliance_bpr )
            call ListBoxAllianceCTP( CRec.alliance_ctp )
         end if
      end if
      display "</FORM>"
   end if
end if   #updateAllow - form 514



############################################
## update section
#   if( URec.ceid='18z7ge5l' )then
   if( not UpdateAllow )then
      display "<p style='margin-top: 10px; margin-bottom: 10px; width: 800px; padding : 4px;vertical-align : middle; background-color: #F0F0F0'><strong>Data Update (Authorized Users Only)</strong>"
      display "</p>"
      display "<FORM ID='upd' ACTION='/", MasterRec.cgi_dir clipped, "/setupUpdS", BRec.b_id clipped, ".ksh'>"
      display "<div style='float: left'>"
      display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped, ">"
      display "EMAIL: <INPUT NAME='yname' TYPE=email size=20 required autocomplete='on'>"
      display "</div>"
#      display "<em><span style='font-size: 20px'>", IRec.i_name clipped, " * ", CtlRec.menu_str clipped,"</span></em></div>"

      display "<div style='float: left'>"
      display "&nbsp;PIN: <INPUT NAME='yid' TYPE=password size=8 required></div>"
      display "<div dir='ltr' style='text-align: center'>"
#      display "<em><span style='font-size: 20px'>", globStr clipped,"</span></em></div>"

      display "<div dir='ltr' style='text-align: left'>"
      display "<INPUT TYPE=submit VALUE='UPDATE'></div>"
      display "<div dir='ltr' style='text-align: left'>"
      display "<em><span style='font-size: 10px'>Authorized Users Only</span></em></div>"
      display "</div>"
      display "</FORM>"
      display "<FORM ID='addBP' ACTION='/", MasterRec.cgi_dir clipped, "/addBP", BRec.b_id clipped, ".ksh'>"
      display "EMAIL: <INPUT NAME='yname' TYPE=email size=20 required autocomplete='on'>"
      display "CEID: <INPUT NAME='ceid' TYPE=text SIZE='15' required>"
      display "Partner Name: <INPUT NAME='part_name' TYPE=text SIZE='40' required>"
      display "<INPUT TYPE=submit VALUE='ADD PARTNER'>"
      display "<div dir='ltr' style='text-align: left'>"
      display "<em><span style='font-size: 10px'>Authorized Users Only</span></em></div>"
      display "</FORM>"

   end if  #not UpdateAllow
#   end if  #for test partner


display "<br>"
call ShowVer(TRUE)


display "</div>"
##-----------------------------------------------------------------------------------------------------
## Build OTHER - END
##-----------------------------------------------------------------------------------------------------

{
#MOD
let skillStr=BuildSkillStr(3)

if( not G_includeskills )then
   if( skillStr is not NULL )then
      display "<div style='text-align: center'>"
      display "<em>Top Skilled in:</em><br />", skillStr clipped, "</div>"
   end if
   display "<div style='text-align: center'>"
   display "<a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/P/", URec.ceid clipped, "-skills.html'>All ", BRec.b_name clipped, " Skills</a><br />"
end if  #G_includeskills
}


{
#MOD
## show VAP details
if( ShowVAPFlg )then
   let G_VAPcnt = LoadVAP( URec.ceid )
   let goVAP = FALSE
   for i = 1 to G_VAPcnt
      if( IsValidVAPforBrand(BRec.b_id, i))then
         let goVAP = TRUE
         exit for
      end if
   end for
   if( goVAP )then
      display "<div style='text-align: center'>"
      display "<a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/P/", URec.ceid clipped, "-vap.html'>VAP Solutions </a><p>"
   end if  #goVAP
end if  #ShowVAPFlg
}

{
## show Solution details
if( CtlRec.showsolutions )then
   let G_VAPcnt = LoadSolutions( URec.ceid )
   let goVAP = FALSE
   if( G_VAPcnt > 0 )then
   for i = 1 to G_VAPcnt
      if( IsValidVAPforBrand(BRec.b_id, i))then
         let goVAP = TRUE
         exit for
      end if
   end for
   if( goVAP )then

      display "<div style='text-align: center'>"
      display "<a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/P/", URec.ceid clipped, "-solutions.html'>Partner Solutions </a><p>"
   end if  #G_VAPcnt > 0
   end if  #goVAP
end if  #ShowVAPFlg
}

{
#MOD
if( ShowFocusArea( URec.focus1, URec.focus2, AREc.focus3) )then
   display "<table align='center' border='1' style='width: 100px'>"
   display "<tbody>"
   display "<tr>"
   display "<td style='background-color: #add8e6' style='text-align: center'>"
   display "Other Focus Areas</td>"
   display "</tr>"
   display "<tr><td>"
   if( URec.focus1 is not null) then
      display URec.focus1 clipped
   else
      display "&nbsp;"
   end if
   display "</td></tr>"
   if( URec.focus2 is not null) then
      display "<tr><td>"
      display URec.focus2 clipped
      display "</td></tr>"
   end if
   if( URec.focus3 is not null) then
      display "<tr><td>"
      display URec.focus3 clipped
      display "</td></tr>"
   end if
   display "</tbody>"
   display "</table>"
   display "<br />"
end if  #showfocusarea
## show other brands
}

{
## display the Partner Segmentation
let i = 0
if( URec.part_type != ' ' and CtlRec.show_cio )then
   let SQLStr = "select a.seg_name from segmentation a where a.seg_id='", URec.part_type, "'"
   prepare SGID from SQLStr
   execute SGID into tseg_name

   if( tseg_name is not null )then
      display "<span style='font-size: 8pt'><a href='../../all/H/Segmentation.html' target='_blank'>Segmentation</a>: ", tseg_name clipped, "</span><br />"
   end if
end if
}

{
if( BPTVRec.pw_level="MEM" )then
   display "<span style='font-size: 8pt'><a href='http://www-304.ibm.com/partnerworld/wps/servlet/ContentHandler/pw_com_lev_index' target='_blank'>PW Level:</a> Member";
#   if( BPTVRec.value_pack = "Yes" )then
#      display " with Value Pack";
#   end if
   display " ", URec.tier using '#', " </span></div>"
else
   if( BPTVRec.pw_level="ADV" )then
      display "<span style='font-size: 8pt'><a href='http://www-304.ibm.com/partnerworld/wps/servlet/ContentHandler/pw_com_lev_index' target='_blank'>PW Level:</a> Advanced";
#      display "<span style='font-size: 8pt'>(PW Level: Advanced";
#      if( BPTVRec.value_pack = "Yes" )then
#         display " with Value Pack";
#      end if
      display " ", URec.tier using '#', " </span></div>"
   else
      if( BPTVRec.pw_level="PRE" )then
         display "<span style='font-size: 8pt'><a href='http://www-304.ibm.com/partnerworld/wps/servlet/ContentHandler/pw_com_lev_index' target='_blank'>PW Level:</a> Premier";
#         display "<span style='font-size: 8pt'>(PW Level: Premier";
#         if( BPTVRec.value_pack = "Yes" )then
#            display " with Value Pack";
#         end if
         display " ", URec.tier using '#', " </span></div>"
      end if  #PRE
   end if  #ADV
end if  #MEM
}

{
## display the hunter flag if appropriate
if( CtlRec.showhunter AND (URec.hunter='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/HUNTER.html' target='_blank'>Hunter</a></span></div>";
end if

## display the commercial flag if appropriate
if( CtlRec.showcommercial AND (URec.commercial='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/COMMERCIAL.html' target='_blank'>Commercial Focus</a></span></div>";
end if

## display the enterprise flag if appropriate
if( CtlRec.showenterprisealign AND (URec.enterprise='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/ENTERPRISE.html' target='_blank'>Enterprise Focus</a></span></div>";
end if

## display the industry flag if appropriate
if( CtlRec.showindustryalign AND (URec.industry='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/INDUSTRY.html' target='_blank'>Industry Focus</a></span></div>";
end if

## display the LAP (Linux Acceleration Program) flag if appropriate
if( CtlRec.showlap AND (URec.lap='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/LAP.html' target='_blank'>LAP</a></span></div>";
end if

## display the DFM (Data First Method) flag if appropriate
if( CtlRec.showdfm AND (URec.dfm='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/DFM.html' target='_blank'>Data First Method Trained</a></span></div>";
end if

## display the Partnering flag if appropriate
if( CtlRec.showpartnerswell AND (URec.partners_well='Y' ))then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/PARTNERS.html' target='_blank'>Partners with Partners</a></span></div>";
end if

## display the Partner Type if appropriate
if( URec.reseller = "G" )then
   display "<div><span style='font-size: 8pt'><a href='../../all/H/GSI.html' target='_blank'>GSI Partner Type</a></span></div>";
end if

## display the Social Review if appropriate
if( CtlRec.showreview )then   #secretVer for testing
   call commentInfo( URec.ceid ) returning rcnt, ravg
   let rStr=getRatingStr(ravg)
   display "<br><div><span style='font-size: 12pt'> >>> Social Feedback <<< </span><br>"
   display rStr, "<br>"
   display "<FORM ID='review' ACTION='/", MasterRec.cgi_dir clipped, "/review", BRec.b_id clipped, ".ksh'>" #method='post'>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,">"
   display "<INPUT NAME='brand' TYPE=hidden READONLY VALUE=", BRec.b_id clipped,">"
   if( rcnt > 1 )then
      display "<INPUT TYPE=submit VALUE='", rcnt using "<<<", " Comments'>"
   else
      if( rcnt=1 )then
         display "<INPUT TYPE=submit VALUE='", rcnt using "<<<", " Comment'>"
      else
         display "<INPUT TYPE=submit VALUE='No Comments Yet'>"
      end if
   end if
   display "</FORM>"

   display "</div>"
end if

############################################
## Certifications (only for Secret pages)
############################################
#display "SECRETVER: ", secretVer 
if( secretVer )then
   display "<tr>"
   display "<td colspan='3' style='text-align: center; background-color: ", colorStr clipped, "; vertical-align: middle'>"
   display "<span style='color: ", textcolorStr clipped, "'><span style='font-size: 22px'>C O V E R A G E - N O T E S</span></span></td>"
   display "</tr>"
   display "<tr>"
   display "<td colspan='3' style='text-align: center; width: 421px; vertical-align: middle'>"
   display "<p>"
   display "&nbsp;</p>"

if( UpdateAllow )then
display "<FORM ID='desc'  ACTION='/", MasterRec.cgi_dir clipped, "/updRec", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit Note Change'>"
   display "<INPUT NAME='form' TYPE=hidden READONLY VALUE=511>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
   display "<TEXTAREA NAME='desc' rows='3' cols='100'>", URec.note clipped, "</TEXTAREA>"
   display "</FORM>"
else
   display  URec.note clipped
end if
   display "</tr>"
end if



############################################
## old VAD Section
############################################
{
if( VRec.v_id != "na" )then
   display "<span style='font-size:18px';>VAD: <a href='", VRec.v_link clipped, "' target='_blank'>", VRec.v_name clipped, "</span> </a></p><br \>"
else
   display "<span style='font-size:18px';>VAD: ", VRec.v_name clipped, "</span> </p><br \>"
end if
display "</td>"
display "</tr>"
}
{
if( URec.updtime is not NULL) then
   display "<tr><td></td><td></td><td>Updated: ", URec.updtime, "</td></tr>"
end if
display "<tr>"
display "<td style='width: 421px'>"
display "&nbsp;</td>"
display "<td style='width: 191px'>"
display "&nbsp;</td>"
display "<td style='width: 115px'>"
display "&nbsp;</td>"
display "</tr>"
display "</tbody>"
display "</table>"
display "<br />"
display "<div>"
display "<span style='visibility: hidden'><span style='font-size: 78%'><span style='position: absolute; left: -2.94%'><span style='color: #7889fb'>–</span></span></span></span></div>"
display "<div>"
display "<span style='font-size: 78%'><span style='position: absolute; left: -2.65%'><span style='font-family: wingdings'><span style='color: #7889fb'>§</span></span></span></span></div>"
display "<div>"
display "<span style='visibility: hidden'><span style='font-size: 133%'><span style='position: absolute; left: -2.65%'><span style='font-family: wingdings'><span style='color: #7889fb'>§</span></span></span></span></span></div>"
display "</div>"
display "<p dir='ltr'>"
display "&nbsp;</p>"
}
end foreach



if( UpdateAllow )then
   display "<HR>"
   display "EDIT EACH SECTION ONE AT A TIME AND PRESS Submit ABOVE THAT SECTION TO SAVE, THEN MOVE TO ANOTHER SECTION AND REPEAT."
   display "<HR>"
   display "<HR>"
end if

#MODcall ShowVer( 1 )

#if (not UpdateAllow )then
#   display "<FORM ID='upd' ACTION='/", MasterRec.cgi_dir clipped, "/setupUpd", BRec.b_id clipped, ".ksh'>"
#   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", URec.ceid clipped,"><br>"
#   display "EMAIL (required to update): <INPUT NAME='yname' TYPE=email size=20 required autocomplete='on'>"
#   display "PIN (required to update): <INPUT NAME='yid' TYPE=password size=8 required>"
#   display "<INPUT TYPE=submit VALUE='UPDATE THIS PARTNER'>"
#   display "</FORM>"
#end if
#
#if( secretVer )then
#   display "<FORM ID='addBP' ACTION='/", MasterRec.cgi_dir clipped, "/addBP", BRec.b_id clipped, ".ksh'>"
#   display "EMAIL (required to add): <INPUT NAME='yname' TYPE=email size=20 required autocomplete='on'>"
##   display "PIN (required to add): <INPUT NAME='yid' TYPE=password size=8 required>"
#   display "CEID: <INPUT NAME='ceid' TYPE=text SIZE='15' required>"
#   display "Partner Name: <INPUT NAME='part_name' TYPE=text SIZE='40' required>"
#   display "<INPUT TYPE=submit VALUE='ADD PARTNER'>"
#   display "</FORM>"
#
#end if

end main

function GetSuccesses( in_ceid )
define
   in_ceid like success_nc.ceid,
   i smallint,
   SQLStr char(256)

   let i = 0
   let SQLStr = "select a.s_title, a.s_link from success_", BRec.b_id clipped, " a where a.ceid='", in_ceid clipped, "'"
   prepare GSID from SQLStr
   declare GSCurs cursor for GSID
   foreach GSCurs into SuccessArr[i+1].*
      let i = i + 1
   end foreach

    return i
end function

function BUText( in_bu )
define
   in_bu char(1),
   retStr char(2)

if( in_bu = "H" )then
   let retStr = "HQ"
else
   let retStr = in_bu
end if

return retStr

end function

function ShowOtherBrands( inBrand, inceid )
define
   inBrand like brands.b_id,      #current brand
   inceid like coverage_nc.ceid   #current CEID

   call LoadActiveBrands( 1, inceid )

   call ShowDetailSection ( inBrand, inceid )

end function #ShowOtherBrands


function ShowFocusArea( Str1, Str2, Str3 )
define
   Str1, Str2, Str3 like coverage_nc.focus1

if( (Str1 is NULL or Str1 = "" or Str1 = " ") AND
    (Str2 is NULL or Str2 = "" or Str2 = " ") AND
    (Str3 is NULL or Str3 = "" or Str3 = " ") )then
   return FALSE
else
   return TRUE
end if

end function  #ShowFocusArea

function GetRevDates()
define
    currYear smallint,
    prevYear smallint

   prepare GRD1 from 
      "select min(year(revdt)) from tbptv"
   execute GRD1 into prevYear
   prepare GRD2 from 
      "select max(year(revdt)) from tbptv"
   execute GRD2 into currYear

## TEMP
#   let prevYear=2014
#   let currYear=2015

   return prevYear, currYear
end function  #GetRevDates


function GetEUDetails()
   define
      i smallint,
      idx smallint

    for i = 1 to 30
       let idx = i     #EUDetails[ EUColNamesArr[i].idx ]

       case EUColNamesArr[ i ].colname

       when 'eu_pacificnw'
          if( URec.eu_pacificnw = 'Y' or URec.eu_pacificnw ='H' )then
             let EUDetails[ idx ] = URec.eu_pacificnw 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_northca'
          if( URec.eu_northca = 'Y' or URec.eu_northca ='H' )then
             let EUDetails[ idx ] = URec.eu_northca 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_southwest'
          if( URec.eu_southwest = 'Y' or URec.eu_southwest ='H' )then
             let EUDetails[ idx ] = URec.eu_southwest 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_northern'
          if( URec.eu_northern = 'Y' or URec.eu_northern ='H' )then
             let EUDetails[ idx ] = URec.eu_northern 
          else
             let EUDetails[ idx ] = ''
          end if

#       when 'eu_chicago'
#          if( URec.eu_chicago = 'Y' or URec.eu_chicago ='H' )then
#             let EUDetails[ idx ] = URec.eu_chicago 
#          else
#             let EUDetails[ idx ] = ''
#          end if

#       when 'eu_minn'
#          if( URec.eu_minn = 'Y' or URec.eu_minn ='H' )then
#             let EUDetails[ idx ] = URec.eu_minn 
#          else
#             let EUDetails[ idx ] = ''
#          end if

       when 'eu_plains'
          if( URec.eu_plains = 'Y' or URec.eu_plains ='H' )then
             let EUDetails[ idx ] = URec.eu_plains 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_heartland'
          if( URec.eu_heartland = 'Y' or URec.eu_heartland ='H' )then
             let EUDetails[ idx ] = URec.eu_heartland 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_texas'
          if( URec.eu_texas = 'Y' or URec.eu_texas ='H' )then
             let EUDetails[ idx ] = URec.eu_texas 
          else
             let EUDetails[ idx ] = ''
          end if

#       when 'eu_gulf'
#          if( URec.eu_gulf = 'Y' or URec.eu_gulf ='H' )then
#             let EUDetails[ idx ] = URec.eu_gulf 
#          else
#             let EUDetails[ idx ] = ''
#          end if

       when 'eu_garden'
          if( URec.eu_garden = 'Y' or URec.eu_garden ='H' )then
             let EUDetails[ idx ] = URec.eu_garden 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_northeast'
          if( URec.eu_northeast = 'Y' or URec.eu_northeast ='H' )then
             let EUDetails[ idx ] = URec.eu_northeast 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_ny'
          if( URec.eu_ny = 'Y' or URec.eu_ny ='H' )then
             let EUDetails[ idx ] = URec.eu_ny 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_delaware'
          if( URec.eu_delaware = 'Y' or URec.eu_delaware ='H' )then
             let EUDetails[ idx ] = URec.eu_delaware 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_potomac'
          if( URec.eu_potomac = 'Y' or URec.eu_potomac ='H' )then
             let EUDetails[ idx ] = URec.eu_potomac 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_carolinas'
          if( URec.eu_carolinas = 'Y' or URec.eu_carolinas ='H' )then
             let EUDetails[ idx ] = URec.eu_carolinas 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_midamerica'
          if( URec.eu_midamerica = 'Y' or URec.eu_midamerica ='H' )then
             let EUDetails[ idx ] = URec.eu_midamerica 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_ohio'
          if( URec.eu_ohio = 'Y' or URec.eu_ohio ='H' )then
             let EUDetails[ idx ] = URec.eu_ohio 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_southeast'
          if( URec.eu_southeast = 'Y' or URec.eu_southeast ='H' )then
             let EUDetails[ idx ] = URec.eu_southeast 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_sunshine'
          if( URec.eu_sunshine = 'Y' or URec.eu_sunshine ='H' )then
             let EUDetails[ idx ] = URec.eu_sunshine 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_fed'
          if( URec.eu_fed = 'Y' or URec.eu_fed ='H' )then
             let EUDetails[ idx ] = URec.eu_fed 
          else
             let EUDetails[ idx ] = ''
          end if

       when 'eu_ca'
          if( URec.eu_ca = 'Y' or URec.eu_ca ='H' )then
             let EUDetails[ idx ] = URec.eu_ca
          else
             let EUDetails[ idx ] = ''
          end if

#       when 'eu_ca_enterprise'
#          if( URec.eu_ca_enterprise = 'Y' or URec.eu_ca_enterprise ='H' )then
#             let EUDetails[ idx ] = URec.eu_ca_enterprise 
#          else
#             let EUDetails[ idx ] = ''
#          end if

#       when 'eu_ca_midmarket'
#          if( URec.eu_ca_midmarket = 'Y' or URec.eu_ca_midmarket ='H' )then
#             let EUDetails[ idx ] = URec.eu_ca_midmarket 
#          else
#             let EUDetails[ idx ] = ''
#          end if

#       when 'eu_fed_dod'
#          if( URec.eu_fed_dod = 'Y' or URec.eu_fed_dod ='H' )then
#             let EUDetails[ idx ] = URec.eu_fed_dod 
#          else
#             let EUDetails[ idx ] = ''
#          end if

       end case
    end for

end function  #GetEUDetails

function GetINDDetails()
   define
      i smallint,
      idx smallint

    for i = 1 to 30
       let idx = i    

       case INDColNamesArr[ i ].i_col

       when 'ind_eu'
          if( URec.ind_eu is not NULL and URec.ind_eu != ' ' )then
             let INDDetails[ idx ] = URec.ind_eu 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_me'
          if( URec.ind_me is not NULL and URec.ind_me != ' ' )then
             let INDDetails[ idx ] = URec.ind_me 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_tel'
          if( URec.ind_tel is not NULL and URec.ind_tel != ' ' )then
             let INDDetails[ idx ] = URec.ind_tel 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_csi'
          if( URec.ind_csi is not NULL and URec.ind_csi != ' ' )then
             let INDDetails[ idx ] = URec.ind_csi 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_consume'
          if( URec.ind_consume is not NULL and URec.ind_consume != ' ' )then
             let INDDetails[ idx ] = URec.ind_consume 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_ret'
          if( URec.ind_ret is not NULL and URec.ind_ret != ' ' )then
             let INDDetails[ idx ] = URec.ind_ret 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_trans'
          if( URec.ind_trans is not NULL and URec.ind_trans != ' ' )then
             let INDDetails[ idx ] = URec.ind_trans 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_bank'
          if( URec.ind_bank is not NULL and URec.ind_bank != ' ' )then
             let INDDetails[ idx ] = URec.ind_bank 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_finan'
          if( URec.ind_finan is not NULL and URec.ind_finan != ' ' )then
             let INDDetails[ idx ] = URec.ind_finan 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_ins'
          if( URec.ind_ins is not NULL and URec.ind_ins != ' ' )then
             let INDDetails[ idx ] = URec.ind_ins 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_defense'
          if( URec.ind_defense is not NULL and URec.ind_defense != ' ' )then
             let INDDetails[ idx ] = URec.ind_defense 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_auto'
          if( URec.ind_auto is not NULL and URec.ind_auto != ' ' )then
             let INDDetails[ idx ] = URec.ind_auto 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_chem'
          if( URec.ind_chem is not NULL and URec.ind_chem != ' ' )then
             let INDDetails[ idx ] = URec.ind_chem 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_elect'
          if( URec.ind_elect is not NULL and URec.ind_elect != ' ' )then
             let INDDetails[ idx ] = URec.ind_elect 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_indprod'
          if( URec.ind_indprod is not NULL and URec.ind_indprod != ' ' )then
             let INDDetails[ idx ] = URec.ind_indprod 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_gov'
          if( URec.ind_gov is not NULL and URec.ind_gov != ' ' )then
             let INDDetails[ idx ] = URec.ind_gov 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_education'
          if( URec.ind_education is not NULL and URec.ind_education != ' ' )then
             let INDDetails[ idx ] = URec.ind_education 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_hl'
          if( URec.ind_hl is not NULL and URec.ind_hl != ' ' )then
             let INDDetails[ idx ] = URec.ind_hl 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_lifesci'
          if( URec.ind_lifesci is not NULL and URec.ind_lifesci != ' ' )then
             let INDDetails[ idx ] = URec.ind_lifesci 
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_fed'
          if( URec.ind_fed is not NULL and URec.ind_fed != ' ' )then
             let INDDetails[ idx ] = URec.ind_fed
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_can'
          if( URec.ind_can is not NULL and URec.ind_can != ' ' )then
             let INDDetails[ idx ] = URec.ind_can
          else
             let INDDetails[ idx ] = ''
          end if

       when 'ind_cross'
          if( URec.ind_cross is not NULL and URec.ind_cross != ' ' )then
             let INDDetails[ idx ] = URec.ind_cross
          else
             let INDDetails[ idx ] = ''
          end if

       end case
    end for

end function  #GetINDDetails

function ShowContactLine( inText )
define
   inText char(80)

   if( inText is not null ) then
      display "<div>"
      display "<div style='position: absolute; left: -2.94%'>"
      display "&nbsp;</div>"
      display "</div>"
      display "<div>"
      display "<span style='font-size: 14px'><span style='font-size: 14px; color: rgb(0,0,0)'>"
      display inText clipped, "</span></span></div>"
end if


end function  #ShowContactLine


function ShowSkillsCurrentBrandS( inBrand, inbIdx)
define
   inBrand like brands.b_id,
   mc, inbIdx smallint,
   starmax, starcnt, i,col_cnt,sidx smallint,
   osc smallint,
   skill_colorStr char(16),
   skill_colorStrL char(16),
   skill_textcolorStr char(16),
   skill_cat smallint,
   color_idx smallint,
   nidx smallint,
   sStr char(128),
   bText like brands.b_name,  #brand long name
   cText, vText char(128),  #vText=visible text, cText=changed for internal HTML use
   starArr array[30] of smallint

   call GetColor(BRec.b_id, 0,1) returning skill_colorStr, skill_textcolorStr
   let bText = GetBrandName( inBrand )
   let vText = bText clipped, " Skills "
#   if( GSkillDt is not null )then
#      let lastchgDtText="<span style="font-size: 8px">(Last Updated: ', date(GSkillDt), ')</span>"
#      display "GSkillDt: ", GSkillDt, "<br>"
#      let vText=vText clipped, '&nbsp;&nbsp;&nbsp;<span style="font-size: 8px">(Last Updated: ', date(GSkillDt), ')</span>'
#   end if
   let cText = noSpaces(vText)

##    Detailed Skill Section - current brand
   call LoadSkillsU( inBrand, inbIdx )


   display "<table border='0' width='744px' cellpadding='5'>"
   display "<tbody><tr>"
   display "<td colspan='100' style='vertical-align: middle; background-color: #F0F0F0'>"
   display "<strong>", vText clipped, "</strong></td></tr>"
   if( GSkillDt is not null )then
#      display "<span style='font-size: 8px'>(Last Updated: ", date(GSkillDt), ")</span>"
      display "<tr><td><span style='font-size: 8px'>(Last Updated: ", GSkillDt, ")</span></td></tr>"
   end if  #GSkillDt


   if( BRec.b_id="SU" )then
      let skill_colorStrL = "rgb(255,255,255)"
   else
      let skill_colorStrL = "rgb(0,0,0)"
   end if
   display "<tr><td>"
   display "<table cellspacing='0' border='0' style='padding-left: 10px;' class='mytable'>"
   display "<tbody>"

if( UpdateAllow )then
   display "<tr><td>"
   display "<FORM ID='skills' ACTION='/", MasterRec.cgi_dir clipped, "/updSkills", BRec.b_id clipped, ".ksh' method='post'>"
   display "<INPUT TYPE=submit VALUE='Submit ",vText clipped," Changes'>"
   display "<INPUT NAME='ceid' TYPE=hidden READONLY VALUE=", CLRec.ceid clipped, ">"
   display "<INPUT NAME='brd' TYPE=hidden READONLY VALUE=", inBrand clipped, ">"
   display "</td></tr>"
end if


   let skill_cat = LoadSkillCat( inBrand )
   if( skill_cat > 0)then
      let osc=-1    ##old skill category
      for i = 1 to skill_cat
         let col_cnt = GetCatCnt( inBrand, SkillCatArr[i].c_id )
#  display "skill_cat: ", skill_cat, " col_cnt: ", col_cnt, " SkillCatArr[i].c_id: ", SkillCatArr[i].c_id, "<br>"
 
#         let tRcnt=PlayInSkillCat( inBrand, SkillCatArr[i].c_id )

         display "<tr><td colspan='1' style='width: 350px; vertical-align: top;'>", SkillCatArr[i].c_long clipped, "</td>"
	 display "<td class='auto-style3'>"
         display "<table width='380' cellspaces='0' class='mytable'>"
         let mc=0
         for sidx = 1 to SkillsMax
#display "Rec:", SkillArrU[inbIdx,sIdx].*
            if( osc != SkillCatArr[i].c_id and (BPSkillsArr[sidx]='1' or BPSkillsArr[sidx]='2' or BPSkillsArr[sidx]='3' or BPSkillsArr[sidx]='4'))then
#            if( osc != SkillCatArr[i].c_id )then
               if( SkillArrU[inbIdx,sidx].s_name != "NA" and SkillArrU[inbIdx,sidx].c_id = i )then
                  if( mc=0 )then
#         display "<tr><td colspan='1' style='width: 350px; vertical-align: top;'>", SkillCatArr[i].c_long clipped, "</td>"
#         display "<td class='auto-style3'>"
#         display "<table width='380' cellspaces='0' class='mytable'>"

                  display "<tr>"
                  end if
                  let mc=mc+1
                  display "<td class='bottomborder2' width='300'>", SkillArrU[inbIdx,sidx].s_desc clipped, "</td>"
                  display "<td class='bottomborder2' width='50'>&nbsp;</td>"
                  display "<td class='' width='150'>"
#                     let mc = mc+1
#                  else
#                     display "<td class='bottomborder2' width=350'>", SkillArrU[inbIdx,sidx].s_desc clipped, "</td>"
#		     let mc = mc+1
#                  end if
                  let starmax=BPSkillsArr[sidx]
#                  display "starmax:", starmax
                     if( starmax >4 )then
                        let starmax=4
                     else 
                        if( starmax < 1 or  starmax is null )then
                           let starmax=0
                        end if
                     end if
                     if( UpdateAllow )then
                        display "<INPUT NAME='", sidx using '<<', "' VALUE=", starmax using '##', ">"
                     else
                        for starcnt=1 to starmax
                           display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>"
                        end for
                        for starcnt=1 to (3-starmax)
                           display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>"
                        end for
                     end if  #UpdateAllow
                     display "</tr><tr>"
               end if
else
 if( SkillArrU[inbIdx,sidx].s_name != "NA" and SkillArrU[inbIdx,sidx].c_id = i and UpdateAllow )then
                  display "<tr>"
                  display "<td class='bottomborder2' width='300'>", SkillArrU[inbIdx,sidx].s_desc clipped, "</td>"
                  display "<td class='bottomborder2' width='50'>&nbsp;</td>"
                  display "<td class='' width='150'>"

                        display "<INPUT NAME='", sidx using '<<', "' VALUE=' '", ">"
                     display "</tr><tr>"
end if
            end if  #osc
         end for  #sidx 
{
	          display "</th><td style='width: 20px; height: 24px;'></td>"
                  display "<td class='centerText' ;='' >"
                  let starmax=0
                  for sidx=1 to mc
                     if( starArr[sidx] >3 )then
                        let starmax=3
                     else 
                        if( starArr[sidx] < 1 or  starArr[sidx] is null )then
                           let starmax=0
                        else
                           let starmax = starArr[sidx]
                        end if
                     end if
                     for starcnt=1 to starmax
                        display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>"
                     end for
                     for starcnt=1 to (3-starmax)
                        display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>"
                     end for
                     if( mc>1 )then
                        display "<br>"
                     end if
                  end for  #mc
}
            display "</table>"
	    display "</td></tr>"

     end for  #loop through skill cats
#     display "</tr>"
  end if  #skill_cat > 0

##MODif( GSkillDt is not NULL) then
##MOD   display "<span style='font-size: 10px'> (Last Updated: ", GSkillDt, ")</span>"
##MODend if
#display "</td></tr>"

if( UpdateAllow )then
   display "</FORM>"
end if

#display "</tr>"
display "</table>"

## display All Skills
#display "<tr><td colspan='100'>"
#display "<div style='text-align: center'>"
#display "<a href='/", IRec.i_id clipped, "/", BRec.b_id clipped, "/P/", URec.ceid clipped, "-skills.html'>All Skills</a><br />"

#display "</tbody>"
 
display "</table>"
#display "<table align='center' border='0' width='744px'>"
#display "<br />"

end function  #ShowSkillsCurrentBrandS

function ShowDetailSection ( inBrand, inceid )
define
   inBrand like brands.b_id,      #current brand
   inceid like coverage_nc.ceid   #current CEID

#   display "<p>Details from Other Brands<br />"

         if( ProductionBrand[ brand_nc ] and inBrand != 'NC' )then
            call ShowDetailLine( "NC", inceid )
         end if
#         if( ProductionBrand[ brand_au ] and inBrand != 'AU' )then
#            call ShowDetailLine( "AU", inceid )
#         end if
#         if( ProductionBrand[ brand_su ] and inBrand != 'SU' )then
#            call ShowDetailLine( "SU", inceid )
#         end if
         if( ProductionBrand[ brand_bu ] and inBrand != 'BU' )then
            call ShowDetailLine( "BU", inceid )
         end if
         if( ProductionBrand[ brand_st ] and inBrand != 'ST' )then
            call ShowDetailLine( "ST", inceid )
         end if
         if( ProductionBrand[ brand_io ] and inBrand != 'IO' )then
            call ShowDetailLine( "IO", inceid )
         end if
         if( ProductionBrand[ brand_cu ] and inBrand != 'CU' )then
            call ShowDetailLine( "CU", inceid )
         end if
         if( ProductionBrand[ brand_es ] and inBrand != 'ES' )then
            call ShowDetailLine( "ES", inceid )
         end if
         if( ProductionBrand[ brand_wu ] and inBrand != 'WU' )then
            call ShowDetailLine( "WU", inceid )
         end if

end function  #ShowDetailSection

function ShowDetailLine( inBrand, inceid )
define
   inBrand like brands.b_id,    #current brand ID for this task
   inceid like coverage_nc.ceid, #current CEID
   Bdesc like brands.b_name,
   SQLStr char(128)

   let SQLStr = "select a.b_name from brands a where a.b_id='", inBrand clipped, "'"
   prepare SDL1ID from SQLStr
   execute SDL1ID into Bdesc

#display inBrand, inceid
#   display "<a href='/", MasterRec.cgi_dir clipped, "/show", inBrand clipped, "S.ksh?", inceid clipped, "' target='_blank'>", Bdesc clipped, "</a><br />"
   display "<a href='/", IRec.i_id clipped, "/", inBrand clipped, "/S/", inceid clipped, ".html' target='_blank'>", Bdesc clipped, "</a><br />"

end function  #ShowDetailLine
{
function ShowDetailLine( inBrandID, inceid )
define
   inBrandID like brands.b_ord,      #current brand ID
   inceid like coverage_nc.ceid   #current CEID

#display inBrandID, inceid
#   display "<a href='/", IRec.i_id clipped, "/", inBrandID clipped, "/P/", inceid clipped, "-nh.html' target='_blank'>", BrandArr[inBrandID].b_name clipped, "</a><br />"
   display "<a href='/", IRec.i_id clipped, "/", BrandArr[inBrandID].b_id clipped, "/P/", inceid clipped, "-nh.html' target='_blank'>", BrandArr[inBrandID].b_name clipped, "</a><br />"

end function  #ShowDetailLine
}
function GetCerts( inbrand, inceid )
define
   inbrand like brands.b_id,
   inceid like coverage_nc.ceid,
   SQLStr char(512),
   i smallint

   let i = 0

   let SQLStr = "select a.* from certs a, brand_certs b, brand_certs_det d where a.brand = b.bc_id and b.b_id = '", 
        inbrand clipped, "' and b.b_id = d.b_id and b.bc_id = d.bc_id and a.prod_group = d.rag ",
        " and a.ceid = '", inceid clipped, "' order by a.prod_group, a.cert_type, a.cert_desc"

   prepare GCID from SQLStr
   declare GCCurs cursor for GCID

   foreach GCCurs into CertArr[i+1].*
      if( i < CertMax )then
         let i = i + 1
      end if
  
   end foreach


   return i
   

end function  #GetCerts

function GetCerts2( inbrand, inceid )
define
   inbrand like brands.b_id,
   inceid like coverage_nc.ceid,
   SQLStr char(512),
   i smallint

   let i = 0

#   let SQLStr = "select  a.brand, a.prod_group, a.cert_type, a.cert_num, a.cert_desc, count(*) cnt from certs a, brand_certs b, brand_certs_det d where a.brand = b.bc_id ",
#        " and b.b_id = d.b_id and b.bc_id = d.bc_id and a.prod_group = d.rag ",
#        " and a.ceid = '", inceid clipped, "' group by 1,2,3,4,5 order by a.prod_group, a.cert_type, a.cert_desc"

   let SQLStr = "select a.prod_group, a.comp_name, a.cert_type, a.cert_num, a.cert_desc, a.sunset_dt, count(*) cnt from certs a where a.ceid = '", inceid clipped, "' group by 2,3,4,5,6, 1 order by a.prod_group, a.cert_type, a.cert_desc, a.comp_name"

   prepare GCID2 from SQLStr
   declare GCCurs2 cursor for GCID2

   foreach GCCurs2 into CertArr[i+1].*
      if( i < CertMax )then
         let i = i + 1
      end if
  
   end foreach


   return i
   

end function  #GetCerts2
{
function noSpaces(inText)
define
   inText char(64),
   rtText char(64),
   i,l smallint

   let l = length(inText)

   for i = 1 to l
      if( inText[i] = ' ' )then
         let rtText[i]='_'
      else
         let rtText[i]=inText[i]
      end if
   end for

   return rtText

end function  #noSpaces
}
function CertCount( inceid, inrag )
define
   inceid like certs.ceid,
   inrag like certs.prod_group,
   sc, tc smallint,
   SQLStr char(512)
    
   let sc = 0
   let tc = 0

#   let SQLStr = "select count(*) cnt from certs a, brand_certs b, brand_certs_det d where a.brand = b.bc_id ",
#        " and b.b_id = d.b_id and b.bc_id = d.bc_id and a.prod_group = d.rag ",
#        " and a.ceid = '", inceid clipped, "' and a.prod_group = '", inrag clipped, "' ", 
#        " and a.cert_type = ? "

   let SQLStr = "select count(*) cnt from certs a where a.ceid = '", inceid clipped, "' and a.prod_group = '", inrag clipped, "' and a.cert_type = ? "
   prepare CC1 from SQLStr

   execute CC1 into sc using "Sales" #into sc
   execute CC1 into tc using "Technical" #into tc

   return sc, tc

end function  #CertCount

{
function showSkillCell( inIdx, colorStr )
define
   inIdx smallint,
   colorStr char(7),
   ret char(256)

   if( inIdx > 0 )then
      let ret = "<td class='centerText'; style='background-color: ", colorStr, "'><strong>", inIdx using "##", "</strong></td>"
   else
      let ret = "<td class='whiteText'; style='background-color: ", colorStr, "'>.</td>"
   end if
#display "inIdx:", inIdx
#display "colorStr:", colorStr
#display "RET: ", ret
   return ret

end function  #showSkillCell
}

function showSkillCell( sIdx, inVal, colorStr )
define
   sIdx smallint,
   inVal smallint,
   colorStr char(7),
   ret char(256)

   if( inVal > 0 )then
      if( UpdateAllow )then
         let ret = "<td class='centerText'; style='background-color: ", colorStr, "'><strong>", "<INPUT NAME='", sIdx using '<<', "' VALUE=", inVal using '##', "></strong></td>"
      else
         let ret = "<td class='centerText'; style='background-color: ", colorStr, "'><strong>", inVal using "##", "</strong></td>"
      end if
   else
      if( UpdateAllow )then
         let ret = "<td class='whiteText'; style='background-color: ", colorStr, "'><INPUT NAME='", sIdx using '<<', "' VALUE=></td>"
      else
         let ret = "<td class='whiteText'; style='background-color: ", colorStr, "'>.</td>"
      end if
   end if
#display "inVal:", inVal
#display "colorStr:", colorStr
#display "RET: ", ret
   return ret

end function  #showSkillCell

function showIndCell( sIdx, inVal, colorStr )
define
   sIdx smallint,
   inVal char(1),
   colorStr char(7),
   ret char(256)

   if( inVal > 0 )then
      if( UpdateAllow )then
         let ret = colorStr
      else
         let ret = colorStr
      end if
   else
      if( UpdateAllow )then
         let ret = colorStr
      else
         let ret = colorStr
      end if
   end if
#display "inVal:", inVal
#display "colorStr:", colorStr
#display "RET: ", ret
   return ret

end function  #showIndCell

function LoadUnitBrand( inUnit )
define
   inUnit char(2),
   SQLStr char(128),
   i smallint

let SQLStr = "select a.* from unit_brand a where a.u_id='", inUnit clipped, "' order by a.ordctp"
prepare LUBID from SQLStr
declare LUBCurs cursor for LUBID

let i = 0
foreach LUBCurs into tUnitBrandRec.*
   let ctpidx = tUnitBrandRec.ordctp
   let UnitBrandArr[ctpidx].* = tUnitBrandRec.*
   let i = i + 1
end foreach

return i

end function  #LoadUnitBrand


function ListBoxSegment( inSel )
define
   inSel char(1),
   sqlStr char(64),
   SegRec record like segmentation.*

   let sqlStr = "select a.* from segmentation a where a.seg_id is not null"
   prepare LBSID from sqlStr
   declare LBSCurs cursor for LBSID

   display "SEGMENT: <SELECT NAME='part_type'>"

   foreach LBSCurs into SegRec.*
   if( inSel = SegRec.seg_id )then
      display "<OPTION SELECTED>", SegRec.seg_id clipped, " - ", SegRec.seg_name clipped
   else
      display "<OPTION>", SegRec.seg_id clipped, " - ", SegRec.seg_name clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSegment


function ListBoxHunter( inSel )
define
   inSel char(1)

   if( CtlRec.showhunter )then
      display "HUNTER: <SELECT NAME='hunter'>"
#   else
#      display "<SELECT NAME='hunter' style='display: none;' >"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Hunter"
   else
      display "<OPTION>",  "N - NOT Hunter"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - Hunter"
   else
      display "<OPTION>",  "Y - Hunter"
   end if

   display "</SELECT>"
   if( CtlRec.showhunter )then
      display "<br>"
   end if
end if  #showhunter
end function  #ListBoxHunter


function ListBoxCommercial( inSel )
define
   inSel char(1)

   if( CtlRec.showcommercial )then
      display "COMMERCIAL FOCUS: <SELECT NAME='commercial'>"
#   else
#      display "<SELECT NAME='commercial' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Commercial Segment"
   else
      display "<OPTION>",  "N - NOT Commercial Segment"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - Commercial Segment"
   else
      display "<OPTION>",  "Y - Commercial Segment"
   end if

   display "</SELECT>"
   if( CtlRec.showcommercial )then
      display "<br>"
   end if
end if  #showcommercial
end function  #ListBoxCommercial

function ListBoxEnterprise( inSel )
define
   inSel char(1)

   if( CtlRec.showenterprisealign )then
      display "ENTERPRISE FOCUS: <SELECT NAME='enterprise'>"
#   else
#      display "<SELECT NAME='enterprise' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Enterprise Segment"
   else
      display "<OPTION>",  "N - NOT Enterprise Segment"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - Enterprise Segment"
   else
      display "<OPTION>",  "Y - Enterprise Segment"
   end if

   display "</SELECT>"
   if( CtlRec.showenterprisealign )then
      display "<br>"
   end if
end if  #showenterprisealign

end function  #ListBoxEnterprise

function ListBoxIndustry( inSel )
define
   inSel char(1)

   if( CtlRec.showindustryalign )then
      display "INDUSTRY FOCUS: <SELECT NAME='industry'>"
#   else
#      display "<SELECT NAME='industry' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Industry Segment"
   else
      display "<OPTION>",  "N - NOT Industry Segment"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - Industry Segment"
   else
      display "<OPTION>",  "Y - Industry Segment"
   end if

   display "</SELECT>"
   if( CtlRec.showindustryalign )then
      display "<br>"
   end if
end if  #showindustryalign
end function  #ListBoxIndustry

function ListBoxLAP( inSel )
define
   inSel char(1)

   if( CtlRec.showlap )then
      display "LAP: <SELECT NAME='lap'>"
#   else
#      display "<SELECT NAME='lap' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT LAP "
   else
      display "<OPTION>",  "N - NOT LAP"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - LAP"
   else
      display "<OPTION>",  "Y - LAP"
   end if

   display "</SELECT>"
   end if

   if( CtlRec.showlap )then
      display "<br>"
   end if


end function  #ListBoxLAP

function ListBoxDFM( inSel )
define
   inSel char(1)

   if( CtlRec.showdfm )then
      display "DFM: <SELECT NAME='dfm'>"
#   else
#      display "<SELECT NAME='dfm' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT DFM "
   else
      display "<OPTION>",  "N - NOT DFM"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - DFM"
   else
      display "<OPTION>",  "Y - DFM"
   end if

   display "</SELECT>"
   end if

   if( CtlRec.showdfm )then
      display "<br>"
   end if


end function  #ListBoxDFM

function ListBoxPartnersWell( inSel )
define
   inSel char(1)

   if( CtlRec.showpartnerswell )then
      display "Partners Well with OTHER Partners: <SELECT NAME='partners_well'>"
#   else
#      display "<SELECT NAME='partners_well' style='display: none;'>"
#   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Partnering Well"
   else
      display "<OPTION>",  "N - NOT Partnering Well"
   end if

   if( inSel = "Y" )then
      display "<OPTION SELECTED>", "Y - Partners Well"
   else
      display "<OPTION>",  "Y - Partners Well"
   end if

   display "</SELECT>"
#   if( CtlRec.showpartnerswell )then
      display "<br>"
   end if

end function  #ListBoxPartnersWell

function ListBoxReseller( inSel )
define
   inSel char(1)

   display "RESELLER CODE: <SELECT NAME='reseller'>"

   if( inSel = "R" )then
      display "<OPTION SELECTED>", "R - Reseller"
   else
      display "<OPTION>",  "R - Reseller"
   end if

   if( inSel = "N" )then
      display "<OPTION SELECTED>", "N - NOT Covered"
   else
      display "<OPTION>",  "N - NOT Covered"
   end if

   if( inSel = "G" )then
      display "<OPTION SELECTED>", "G - GSI"
   else
      display "<OPTION>",  "G - GSI"
   end if

   if( inSel = "V" )then
      display "<OPTION SELECTED>", "V - VAD"
   else
      display "<OPTION>",  "V - VAD"
   end if

   if( inSel = "X" )then
      display "<OPTION SELECTED>", "X - NOT PARTNER"
   else
      display "<OPTION>",  "X - NOT PARTNER"
   end if

   display "</SELECT><br>"
end function  #ListBoxReseller

{
function ListBoxVAD( inSel )
define
   inSel like coverage_nc.vad,
   sqlStr char(64),
   VADRec record like vads.*

   let sqlStr = "select a.* from vads a "
   prepare LBVID from sqlStr
   declare LBVCurs cursor for LBVID

   display "VAD: <SELECT NAME='vad'>"

   foreach LBVCurs into VADRec.*
   if( inSel = VADRec.v_id )then
      display "<OPTION SELECTED>", VADRec.v_id clipped
   else
      display "<OPTION>", VADRec.v_id clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxVAD
}

function ListBoxSSR( inSel, inSSRStr )
define
   inSel like coverage_nc.ssr,
   inSSRStr like control.bpr_ltext,
   sqlStr char(512),
   tssr like coverage_nc.ssr

   if( inSSRStr is null or inSSRStr=" " )then
      let inSSRStr="BPR"
   end if

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CS' and ", 
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ssr from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBSSRID from sqlStr
   declare LBSSRCurs cursor for LBSSRID

   display inSSRStr clipped, ": <SELECT NAME='ssr'>"

   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps

   foreach LBSSRCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSSR


function ListBoxFlash( inSel )
define
   inSel like cross.flash,
   sqlStr char(64),
   tssr like cross.flash

   let sqlStr = "select unique a.flash from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBFLAID from sqlStr
   declare LBFLACurs cursor for LBFLAID

   display "FLASH Rep: <SELECT NAME='flash'>"

   foreach LBFLACurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxFlash

function ListBoxSPR( inSel )
define
   inSel like cross.spr,
   sqlStr char(64),
   tssr like cross.spr

   let sqlStr = "select unique a.spr from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBSPRID from sqlStr
   declare LBSPRCurs cursor for LBSPRID

   display "SPR Rep: <SELECT NAME='spr'>"

   foreach LBSPRCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSPR

function ListBoxSPRHW( inSel )
define
   inSel like cross.spr_hw,
   sqlStr char(64),
   tssr like cross.spr_hw

   let sqlStr = "select unique a.spr_hw from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBSPRHWID from sqlStr
   declare LBSPRHWCurs cursor for LBSPRHWID

   display "SPR-HW Rep: <SELECT NAME='spr_hw'>"

   foreach LBSPRHWCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSPRHW


function ListBoxSPRPower( inSel )
define
   inSel like cross.spr_power,
   sqlStr char(64),
   tssr like cross.spr_power

   let sqlStr = "select unique a.spr_power from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBSPRPWID from sqlStr
   declare LBSPRPWCurs cursor for LBSPRPWID

   display "SPR-Power Rep: <SELECT NAME='spr_power'>"

   foreach LBSPRPWCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSPRPower

function ListBoxPTA( inSel )
define
   inSel like cross.pta_hw,
   sqlStr char(64),
   tssr like cross.pta_hw

   let sqlStr = "select unique a.pta from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBPTAID from sqlStr
   declare LBPTACurs cursor for LBPTAID

   display "PTA-Storage Rep: <SELECT NAME='pta_hw'>"

   foreach LBPTACurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxPTA

function ListBoxPTAPower( inSel )
define
   inSel like cross.pta_hw,
   sqlStr char(64),
   tssr like cross.pta_hw

   let sqlStr = "select unique a.pta_hw from ", CtlRec.coverextend_tab clipped, " a order by 1"
   prepare LBPTAHWID from sqlStr
   declare LBPTAHWCurs cursor for LBPTAHWID

   display "PTA-Power Rep: <SELECT NAME='pta_hw'>"

   foreach LBPTAHWCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxPTAPower

{
function ListBoxPCR( inSel )
define
   inSel like cross.pcr,
   sqlStr char(64),
   tssr like cross.pcr

   let sqlStr = "select unique a.pcr from cross a order by 1"
   prepare LBPCRID from sqlStr
   declare LBPCRCurs cursor for LBPCRID

   display "PCR Rep: <SELECT NAME='pcr'>"

   foreach LBPCRCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxPCR
}
function ListBoxzRep( inSel )
define
   inSel like cross.pcr,
   sqlStr char(64),
   tssr like cross.pcr

   let sqlStr = "select unique a.zrep from cross a order by 1"
   prepare LBzRepID from sqlStr
   declare LBzRepCurs cursor for LBzRepID

   display "zRep Rep: <SELECT NAME='zrep'>"

   foreach LBzRepCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxzRep

function ListBoxSWITA( inSel )
define
   inSel like cross.pcr,
   sqlStr char(64),
   tssr like cross.pcr

   let sqlStr = "select unique a.swita from cross a order by 1"
   prepare LBSWITAID from sqlStr
   declare LBSWITACurs cursor for LBSWITAID

   display "SCA Rep: <SELECT NAME='swita'>"

   foreach LBSWITACurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxSWITA

function ListBoxAllianceBPR( inSel )
define
   inSel like cross.alliance_bpr,
   sqlStr char(64),
   tssr like cross.alliance_bpr

   let sqlStr = "select unique a.alliance_bpr from cross a order by 1"
   prepare LBABPRID from sqlStr
   declare LBABPRCurs cursor for LBABPRID

   display "Alliance BPR: <SELECT NAME='alliance_bpr'>"

   foreach LBABPRCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxAllianceBPR

function ListBoxAllianceCTP( inSel )
define
   inSel like cross.alliance_ctp,
   sqlStr char(64),
   tssr like cross.alliance_ctp

   let sqlStr = "select unique a.alliance_ctp from cross a order by 1"
   prepare LBACTPID from sqlStr
   declare LBACTPCurs cursor for LBACTPID

   display "Alliance BPR: <SELECT NAME='alliance_ctp'>"

   foreach LBACTPCurs into tssr
   if( inSel = tssr )then
      display "<OPTION SELECTED>", tssr clipped
   else
      display "<OPTION>",tssr clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxAllianceCTP

function ListBoxCTP1( inSel )
define
   inSel like coverage_nc.ctp1,
   sqlStr char(256),
   tctp like coverage_nc.ctp1

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CT' and ", 
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ctp1 from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBCTP1ID from sqlStr
   declare LBCTP1Curs cursor for LBCTP1ID

#   if( BRec.b_id = 'SU' )then
#      display "TSS #1 (", UnitBrandArr[1].desc clipped, "): <SELECT NAME='ctp1' '", URec.ctp1 clipped,"'><br>"
#   else
   display "TSS #1 (", UnitBrandArr[1].b_id clipped, "): <SELECT NAME='ctp1'>"
#   end if

   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps
   foreach LBCTP1Curs into tctp
   if( inSel = tctp )then
      display "<OPTION SELECTED>", tctp clipped
      else
      display "<OPTION>",tctp clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxCTP1


function ListBoxCTP2( inSel )
define
   inSel like coverage_nc.ctp2,
   sqlStr char(256),
   tctp like coverage_nc.ctp2

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CT' and ",
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ctp2 from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBCTP2ID from sqlStr
   declare LBCTP2Curs cursor for LBCTP2ID

   display "TSS #2 (", UnitBrandArr[2].b_id clipped, "): <SELECT NAME='ctp2'>"

   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps
   foreach LBCTP2Curs into tctp
   if( inSel = tctp )then
      display "<OPTION SELECTED>", tctp clipped
   else
      display "<OPTION>",tctp clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxCTP2


function ListBoxCTP3( inSel )
define
   inSel like coverage_nc.ctp3,
   sqlStr char(256),
   tctp like coverage_nc.ctp3

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CT' and ",
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ctp3 from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBCTP3ID from sqlStr
   declare LBCTP3Curs cursor for LBCTP3ID

   display "TSS #3 (", UnitBrandArr[3].b_id clipped, "): <SELECT NAME='ctp3'>"
   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps
   foreach LBCTP3Curs into tctp
   if( inSel = tctp )then
      display "<OPTION SELECTED>", tctp clipped
   else
      display "<OPTION>",tctp clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxCTP3

function ListBoxCTP4( inSel )
define
   inSel like coverage_nc.ctp4,
   sqlStr char(256),
   tctp like coverage_nc.ctp4

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CT' and ",
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ctp4 from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBCTP4ID from sqlStr
   declare LBCTP4Curs cursor for LBCTP4ID

   display "TSS #4 (", UnitBrandArr[4].b_id clipped, "): <SELECT NAME='ctp4'>"
   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps

   foreach LBCTP4Curs into tctp
   if( inSel = tctp )then
      display "<OPTION SELECTED>", tctp clipped
   else
      display "<OPTION>",tctp clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxCTP4

function ListBoxCTP5( inSel )
define
   inSel like coverage_nc.ctp5,
   sqlStr char(256),
   tctp like coverage_nc.ctp5

   if( CtlRec.use_reps )then
      let sqlStr = "select unique a.r_name from reps a where r_type='CT' and ",
                   "b_id='", BRec.b_id clipped, "' order by 1"
   else
      let sqlStr = "select unique a.ctp5 from ", cov_tab clipped, " a order by 1"
   end if  #use_reps
   prepare LBCTP5ID from sqlStr
   declare LBCTP5Curs cursor for LBCTP5ID

   display "TSS #5 (", UnitBrandArr[5].b_id clipped, "): <SELECT NAME='ctp5'>"
   if( CtlRec.use_reps )then
      display "<OPTION></OPTION>"
   end if  #use_reps

   foreach LBCTP5Curs into tctp
   if( inSel = tctp )then
      display "<OPTION SELECTED>", tctp clipped
   else
      display "<OPTION>",tctp clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxCTP5


function ListBoxRegion( inSel )
define
   inSel like eus.e_region,
   sqlStr char(128),
   EUSRec record like eus.*

   let sqlStr = "select unique a.e_region from eus a where a.e_brand='", BRec.b_id clipped, "' order by 1 "
   prepare LBRegID from sqlStr
   declare LBRegCurs cursor for LBRegID

   display "REGION: <SELECT NAME='e_region'>"

   foreach LBRegCurs into EUSRec.e_region
   if( inSel = EUSRec.e_region )then
      display "<OPTION SELECTED>", EUSRec.e_region clipped
   else
      display "<OPTION>", EUSRec.e_region clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxRegion

function ListBoxEUS( inReg, inSel )
define
   inReg like eus.e_region,
   inSel like eus.e_name,
   sqlStr char(128),
   EUSRec record like eus.*,
   tregion like eus.e_region

   let sqlStr = "select unique a.e_region, a.e_name from eus a where a.e_brand='", BRec.b_id clipped, "' order by 1,2 "
   prepare LBEUSID from sqlStr
   declare LBEUSCurs cursor for LBEUSID

   display "EUS: <SELECT NAME='e_name'>"

   foreach LBEUSCurs into tregion, EUSRec.e_name
   if( inSel = EUSRec.e_name )then
      display "<OPTION SELECTED>", EUSRec.e_name clipped
   else
      display "<OPTION>", EUSRec.e_name clipped
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxEUS

function ListBoxActType( inSel )
define
   inSel like activity.act_code,
   sqlStr char(64),
   tctp like activity.act_code,
   tRec record like alu_type.*

   let sqlStr = "select unique a.* from alu_type a order by a.ord"
   prepare LBATID from sqlStr
   declare LBATCurs cursor for LBATID

   display "<SELECT NAME='at'><br>"

   foreach LBATCurs into tRec.*

   if( inSel = tRec.alu_code )then
      display "<OPTION SELECTED>", tRec.alu_code clipped, " - ", tRec.alu_type
   else
      display "<OPTION>", tRec.alu_code clipped, " - ", tRec.alu_type
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxActType

function ListBoxActStatus( inSel )
define
   inSel like activity.act_stat,
   sqlStr char(64),
   tctp like activity.act_stat,
   tRec record like alu_status.*

   let sqlStr = "select unique a.* from alu_status a order by a.ord"
   prepare LBASID from sqlStr
   declare LBASCurs cursor for LBASID

   display "<SELECT NAME='as'><br>"

   foreach LBASCurs into tRec.*

   if( inSel = tRec.alu_stat )then
      display "<OPTION SELECTED>", tRec.alu_stat clipped, " - ", tRec.alu_stat_desc
   else
      display "<OPTION>", tRec.alu_stat clipped, " - ", tRec.alu_stat_desc
   end if
   
   end foreach

   display "</SELECT><br>"
end function  #ListBoxActStatus

function ListBoxActInit( inSel )
define
   inSel like act_initiative.bp_init1,
   sqlStr char(512),
   tctp like act_initiative.bp_init1,
   tRec record like act_initiative.*

   let sqlStr = "select unique a.* from ", CtlRec.act_init_tab clipped ," a where a.ceid='", URec.ceid clipped, "'"
   prepare LBATIID from sqlStr
   execute LBATIID into tRec.*


   display "<SELECT NAME='ati'><br>"

   if( tRec.bp_init1 is not null )then
      if( inSel = tRec.bp_init1 )then
         display "<OPTION SELECTED>", tRec.bp_init1 clipped
      else
         display "<OPTION>", tRec.bp_init1 clipped
      end if
   end if

   if( tRec.bp_init2 is not null )then
      if( inSel = tRec.bp_init2 )then
         display "<OPTION SELECTED>", tRec.bp_init2 clipped
      else
         display "<OPTION>", tRec.bp_init2 clipped
      end if
   end if

   if( tRec.bp_init3 is not null )then
      if( inSel = tRec.bp_init3 )then
         display "<OPTION SELECTED>", tRec.bp_init3 clipped
      else
         display "<OPTION>", tRec.bp_init3 clipped
      end if
   end if

   if( tRec.st_init1 is not null )then
      if( inSel = tRec.st_init1 )then
         display "<OPTION SELECTED>", tRec.st_init1 clipped
      else
         display "<OPTION>", tRec.st_init1 clipped
      end if
   end if

   if( tRec.st_init2 is not null )then
      if( inSel = tRec.st_init2 )then
         display "<OPTION SELECTED>", tRec.st_init2 clipped
      else
         display "<OPTION>", tRec.st_init2 clipped
      end if
   end if

   if( tRec.st_init3 is not null )then
      if( inSel = tRec.st_init3 )then
         display "<OPTION SELECTED>", tRec.st_init3 clipped
      else
         display "<OPTION>", tRec.st_init3 clipped
      end if
   end if

   display "</SELECT><br>"
end function  #ListBoxActInit

function inSVP( inComp )
define
   inComp like competency.comp_name,
   i smallint,
   retVal smallint

   let retVal = FALSE
#display "G_SVPinfocnt: ", G_SVPinfocnt
   for i = 1 to G_SVPinfocnt
#display "inComp:", inComp clipped
#display "CVR:", SVPInfoArr[i].prod_grp_desc clipped
#display "SVP_NAME:", SVPInfoArr[i].svp_name clipped

      if( inComp = SVPInfoArr[i].comp_name )then
         let retVal = TRUE
      end if
   end for
   
   return retVal

end function  #inSVP

function inComp( inComp )
define
   inComp like competency.comp_name,
   i smallint,
   retVal smallint,
   idx smallint

   let retVal = FALSE
   let idx = 0
#display "G_SVPinfocnt: ", G_SVPinfocnt
   for i = 1 to G_COMPcnt
#display "inComp:", inComp clipped
#display "SVP:", SVPInfoArr[i].prod_grp_desc clipped
#display "SVP_NAME:", SVPInfoArr[i].svp_name clipped

      if( inComp = CompArr[i].comp_name )then
         let retVal = TRUE
         let idx = i
      end if
   end for
   
   return retVal, idx

end function  #inComp


function AddPlus( inStr )
define
   inStr char(100),
   i,l smallint

   let l=length(inStr)

   for i=1 to l
      if( inStr[i]=" " )then
         let inStr[i]="+"
      end if
   end for

   return inStr

end function  #AddPlus

function LoadTargets( inCEID ) 
define
   inCEID like target.t_ceid,
   TrgRec record like target.*,
   SQLStr char(512)

   let SQLStr = "select a.* from target a where a.t_ceid='", inCEID clipped, "'"
   prepare LTID from SQLStr
   execute LTID into TrgRec.*

   return TrgRec.*

end function  #LoadTargets

function  DispSkillLegend( UpdMode )
define
   UpdMode smallint

if( UpdMode )then
   display "LEGEND: ", 
        " 4 = ", MasterRec.best_msg clipped, ", "
   display 
        " 3 = ", MasterRec.top_msg clipped, ", "
   display 
        " 2 = ", MasterRec.middle_msg clipped, ", "
   display 
        " 1 = ", MasterRec.low_msg clipped, ", "
   display 
        " ' '= ", "Not a Focus"
else
   display "LEGEND: "
   display "&nbsp;"
   display "<img onclick='skillPopUp()' style='cursor: hand; margin-bottom: 2px;' height='17' src='/NA/I/question.jpg' width='20' alt='' title='Skill Explanation'>"
   display "<div class='popup' onclick='skillPopUp()'>"
   display "<div class='popuptext' id='SPUP'><h2>Skill Explanation</h2>"
   display MasterRec.skill_txt
   display "</div>"
   display "</div>"
   display
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        " = ", MasterRec.best_msg clipped, ", "
   display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        " = ", MasterRec.top_msg clipped, ", "
   display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", MasterRec.middle_msg clipped, ", "
   display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", MasterRec.low_msg clipped, ", "
   display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", "Not a Focus"
end if  #UpdMode



end function  #DispSkillLegend

function  DispMarketLegend( UpdMode )
define
   UpdMode smallint

if( UpdMode )then
   display "LEGEND: "
   display 
        " 3 = ", MasterRec.ind_3 clipped, ", "
   display 
        " 2 = ", MasterRec.ind_2 clipped, ", "
   display 
        " 1 = ", MasterRec.ind_1 clipped, ", "
   display 
        " ' '= ", "Not a Focus"
else
display "LEGEND: ", 
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        " = ", MasterRec.ind_3 clipped
display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", MasterRec.ind_2 clipped
display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/stargold.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", MasterRec.ind_1 clipped
display "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        "<img style='margin-bottom: 2px;' height='15' src='/", IRec.i_id clipped, "/I/starplain.jpg' width='20'>",
        " = ", "Not a Focus"
end if  #UpdMode

end function  #DispMarketLegend

function PlayInRegion( inReg )
define
   inReg like region.e_region,
   RegID like region.e_ord,
   i, idx smallint,
   retVal smallint

   let retVal=0

#display "inReg: ", inReg clipped, "<br>"
   for idx=1 to G_EUcnt
      if( EUArr[idx].e_region = inReg )then
         for i=1 to G_NumCols
            if( EUColNamesArr[i].idx = EUArr[idx].e_id )then
               if(  EUDetails[ i ]="Y" or EUDetails[ i ]="H" )then
                  let retVal=retVal+1
               end if  #Y/H
#               display "EUDetails:", EUDetails[i], "<br>"
#               display "Col:", EUColNamesArr[i].idx, "<br>"
            end if
         end for
      end if
   end for

   return retVal
end function  #PlayInRegion


function PlayInMarket( inMkt )
define
   inMkt like market.m_name,
   MID like market.ord,
   i, idx smallint,
   retVal smallint

   let retVal=0

{
## help with Debuggin
   for idx=1 to 30
      display "idx: ", idx, " INDDetails[idx]:", INDDetails[idx], "<br>"
   end for
   for idx=1 to G_INDNumCols
      display "idx: ", idx, " INDColNamesArr[idx].i_col:", INDColNamesArr[idx].i_col clipped, "<br>"
   end for

   for idx=1 to G_INDNumCols
      display "idx: ", idx, " INDArr[idx].*:", INDArr[idx].* clipped, "<br>"
   end for
}

#   display "G_MKcnt: ", G_MKcnt, "<br>"
#   display "G_INDNumCols: ", G_INDNumCols, "<br>"

   for idx=1 to G_MKcnt
#      display "MKArr[", idx, "].name:", MKArr[idx].m_name clipped, " =? inMkt: ", inMkt clipped, "<br>"

      if( MKArr[idx].m_name = inMkt )then
         for i=1 to G_INDNumCols
#            display INDColNamesArr[i].idx, " : ", MKArr[idx].ord, "<br>"
            if( INDArr[i].ig_name = MKArr[idx].m_name )then
#               display "INDColNamesArr[i].idx:", INDColNamesArr[i].idx, " idx: ", idx, " i: ", i, "<br>"
#               display "MKArr[idx].ord:", MKArr[idx].ord, "<br>"
#               display "INDDetails[i]:", INDDetails[i], "<br>"
               if( INDDetails[i]='Y' or INDDetails[i]='1' or INDDetails[i]='2' or INDDetails[i]='3' or INDDetails[i]='4')then
                  let retVal=retVal+1
#                  display "retVal: ", retVal, "<br>"
               end if  #Y/H
#               display "Col:", INDColNamesArr[i].idx, "<br>"
            end if
         end for
         exit for  #found the right market
      end if
   end for

   return retVal
end function  #PlayInMarket

